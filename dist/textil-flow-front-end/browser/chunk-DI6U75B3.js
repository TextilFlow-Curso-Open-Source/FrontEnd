import{a as te,b as ie,c as ne}from"./chunk-637EA4O6.js";import{b as ae}from"./chunk-ENPCZ4PV.js";import{a as ee}from"./chunk-JGNPUBHB.js";import{f as X}from"./chunk-PHS4C33R.js";import{S as Z,c as G,g as Y,j as Q,q as J}from"./chunk-3QVQVNEG.js";import"./chunk-ZM53J4V7.js";import{a as x,c as $}from"./chunk-OYL6LJLT.js";import{b as K}from"./chunk-GG34XMCG.js";import{c as L,d as F,e as N,j as z,l as U}from"./chunk-6CUNOLLP.js";import{C as W,z as q}from"./chunk-PY2MZTIA.js";import"./chunk-QHSPJAHQ.js";import"./chunk-2V72WRPO.js";import{$a as r,Ab as M,Hb as i,Ib as n,Jb as I,Nb as C,Rb as h,Sb as p,Vb as B,Za as S,bc as o,cc as v,dc as f,eb as P,fc as j,gc as k,hc as y,ic as A,la as _,lb as H,lc as D,ma as g,nc as l,oc as d,pc as V,qb as b,yb as u}from"./chunk-3V6P7TZ6.js";var oe=()=>[1,2,3,4,5];function ce(s,t){if(s&1&&(i(0,"span",20),o(1),n()),s&2){let e=p(2);r(),f("(",e.filteredBatches.length,")")}}function se(s,t){if(s&1){let e=C();i(0,"button",21),h("click",function(){_(e);let a=p(2);return g(a.clearSearch())}),i(1,"i",22),o(2,"close"),n()()}}function le(s,t){if(s&1){let e=C();i(0,"div",23)(1,"div",24)(2,"button",25),h("click",function(){_(e);let a=p(2);return g(a.setStatusFilter(null))}),i(3,"i",22),o(4,"select_all"),n(),o(5),l(6,"translate"),n(),i(7,"button",25),h("click",function(){_(e);let a=p(2);return g(a.setStatusFilter("Enviado"))}),i(8,"span",26),o(9,"\u25CF"),n(),o(10),l(11,"translate"),n(),i(12,"button",25),h("click",function(){_(e);let a=p(2);return g(a.setStatusFilter("Aceptado"))}),i(13,"span",27),o(14,"\u25CF"),n(),o(15),l(16,"translate"),n()()()}if(s&2){let e=p(2);r(2),M("active",!e.statusFilter),r(3),f(" ",d(6,9,"BATCH.ALL_STATUSES")," "),r(2),M("active",e.statusFilter==="Enviado"),r(3),f(" ",d(11,11,"BATCH.STATUS_SENT")," "),r(2),M("active",e.statusFilter==="Aceptado"),r(3),f(" ",d(16,13,"BATCH.STATUS_ACCEPTED")," ")}}function de(s,t){s&1&&(i(0,"div",31),I(1,"div",32)(2,"div",32)(3,"div",32)(4,"div",32)(5,"div",32)(6,"div",32),n())}function pe(s,t){s&1&&(i(0,"div",28)(1,"div",29),b(2,de,7,0,"div",30),n()()),s&2&&(r(2),u("ngForOf",D(1,oe)))}function me(s,t){if(s&1){let e=C();i(0,"app-button",36),l(1,"translate"),h("click",function(){_(e);let a=p(3);return g(a.clearSearch())}),n()}s&2&&B("label",d(1,1,"BATCH.CLEAR_SEARCH"))}function _e(s,t){if(s&1&&(i(0,"div",33)(1,"div",34)(2,"i",22),o(3,"inventory_2"),n()(),i(4,"h3"),o(5),l(6,"translate"),l(7,"translate"),n(),i(8,"p"),o(9),l(10,"translate"),l(11,"translate"),n(),b(12,me,2,3,"app-button",35),n()),s&2){let e=p(2);r(5),v(e.searchTerm?d(6,3,"BATCH.NO_MATCHING_BATCHES"):d(7,5,"BATCH.NO_BATCHES_YET")),r(4),v(e.searchTerm?d(10,7,"BATCH.TRY_DIFFERENT_SEARCH"):d(11,9,"BATCH.START_MANAGING_BATCHES")),r(3),u("ngIf",e.searchTerm)}}function ge(s,t){if(s&1){let e=C();i(0,"button",62),l(1,"translate"),h("click",function(){_(e);let a=p().$implicit,m=p(3);return g(m.quickApprove(a))}),i(2,"i",22),o(3,"check_circle"),n()()}s&2&&u("title",d(1,1,"BATCH.QUICK_APPROVE"))}function ue(s,t){if(s&1){let e=C();i(0,"button",63),l(1,"translate"),h("click",function(){_(e);let a=p().$implicit,m=p(3);return g(m.quickReject(a))}),i(2,"i",22),o(3,"cancel"),n()()}s&2&&u("title",d(1,1,"BATCH.QUICK_REJECT"))}function he(s,t){if(s&1){let e=C();i(0,"tr",45),h("click",function(){let a=_(e).$implicit,m=p(3);return g(m.viewBatchDetails(a))}),i(1,"td",46)(2,"div",47)(3,"i",48),o(4,"qr_code"),n(),i(5,"strong"),o(6),n()()(),i(7,"td")(8,"div",49)(9,"span",50),o(10),n()()(),i(11,"td")(12,"span",51),o(13),n()(),i(14,"td")(15,"span",52),o(16),l(17,"date"),n()(),i(18,"td")(19,"div",53)(20,"span",54)(21,"i",55),o(22),n(),o(23),n()()(),i(24,"td",42)(25,"span",56),o(26),n()(),i(27,"td",57),h("click",function(a){return _(e),g(a.stopPropagation())}),i(28,"div",58),b(29,ge,4,3,"button",59)(30,ue,4,3,"button",60),i(31,"button",61),l(32,"translate"),h("click",function(){let a=_(e).$implicit,m=p(3);return g(m.viewBatchDetails(a))}),i(33,"i",22),o(34,"visibility"),n()()()()()}if(s&2){let e=t.$implicit,c=p(3);M("urgent",c.isUrgentBatch(e)),r(6),v(e.code||"N/A"),r(4),v(c.getSupplierCompanyName(e.supplierId)),r(3),v(e.fabricType||"N/A"),r(3),v(V(17,13,e.date,"dd/MM/yy")),r(4),u("ngClass",c.getStatusClass(e.status)),r(2),v(c.getStatusIcon(e.status)),r(),f(" ",e.status||"N/A"," "),r(3),f("s/",e.price||"N/A",""),r(3),u("ngIf",c.canApproveOrReject(e)),r(),u("ngIf",c.canApproveOrReject(e)),r(),u("title",d(32,16,"BATCH.VIEW_DETAILS"))}}function fe(s,t){if(s&1){let e=C();i(0,"div",37)(1,"table",38)(2,"thead")(3,"tr")(4,"th",39),h("click",function(){_(e);let a=p(2);return g(a.sortBy("code"))}),i(5,"div",40),o(6),l(7,"translate"),i(8,"i",41),o(9,"swap_vert"),n()()(),i(10,"th",39),h("click",function(){_(e);let a=p(2);return g(a.sortBy("client"))}),i(11,"div",40),o(12),l(13,"translate"),i(14,"i",41),o(15,"swap_vert"),n()()(),i(16,"th"),o(17),l(18,"translate"),n(),i(19,"th",39),h("click",function(){_(e);let a=p(2);return g(a.sortBy("date"))}),i(20,"div",40),o(21),l(22,"translate"),i(23,"i",41),o(24,"swap_vert"),n()()(),i(25,"th"),o(26),l(27,"translate"),n(),i(28,"th",42),o(29),l(30,"translate"),n(),i(31,"th",43),o(32),l(33,"translate"),n()()(),i(34,"tbody"),b(35,he,35,18,"tr",44),n()()()}if(s&2){let e=p(2);r(6),f(" ",d(7,9,"BATCH.BATCH_CODE")," "),r(6),f(" ",d(13,11,"BATCH.SUPPLIER")," "),r(5),v(d(18,13,"BATCH.FABRIC_TYPE")),r(4),f(" ",d(22,15,"BATCH.DATE")," "),r(5),v(d(27,17,"BATCH.STATUS")),r(3),v(d(30,19,"BATCH.PRICE")),r(3),v(d(33,21,"COMMON.ACTIONS")),r(3),u("ngForOf",e.filteredBatches)("ngForTrackBy",e.trackByBatchId)}}function ve(s,t){if(s&1){let e=C();i(0,"div")(1,"div",5)(2,"div",6)(3,"h2")(4,"i",7),o(5,"inventory_2"),n(),o(6),l(7,"translate"),b(8,ce,2,1,"span",8),n()(),i(9,"div",9)(10,"div",10)(11,"i",11),o(12,"search"),n(),i(13,"input",12),l(14,"translate"),A("ngModelChange",function(a){_(e);let m=p();return y(m.searchTerm,a)||(m.searchTerm=a),g(a)}),h("input",function(){_(e);let a=p();return g(a.filterBatches())})("keyup.enter",function(){_(e);let a=p();return g(a.filterBatches())}),n(),b(15,se,3,0,"button",13),n(),i(16,"app-button",14),l(17,"translate"),h("click",function(){_(e);let a=p();return g(a.toggleFilters())}),n(),i(18,"app-button",15),l(19,"translate"),h("click",function(){_(e);let a=p();return g(a.loadBatches())}),n()()(),b(20,le,17,15,"div",16)(21,pe,3,2,"div",17)(22,_e,13,11,"div",18)(23,fe,36,23,"div",19),n()}if(s&2){let e=p();r(6),f(" ",d(7,12,"BATCH.MY_BATCHES")," "),r(2),u("ngIf",!e.isLoading),r(5),B("placeholder",d(14,14,"BATCH.SEARCH_PLACEHOLDER")),k("ngModel",e.searchTerm),r(2),u("ngIf",e.searchTerm),r(),B("label",d(17,16,"COMMON.FILTER")),r(2),B("label",d(19,18,"COMMON.REFRESH")),u("loading",e.isLoading),r(2),u("ngIf",e.showQuickFilters),r(),u("ngIf",e.isLoading),r(),u("ngIf",!e.isLoading&&e.filteredBatches.length===0),r(),u("ngIf",!e.isLoading&&e.filteredBatches.length>0)}}function xe(s,t){if(s&1){let e=C();i(0,"div",74)(1,"div",75)(2,"i",22),o(3,"image"),n(),i(4,"h3"),o(5),l(6,"translate"),n()(),i(7,"img",76),l(8,"translate"),h("click",function(){_(e);let a=p(2);return g(a.openImageModal(a.selectedBatch.imageUrl))}),n()()}if(s&2){let e=p(2);r(5),v(d(6,3,"BATCH.BATCH_IMAGE")),r(2),B("alt",d(8,5,"BATCH.BATCH_IMAGE")),u("src",e.selectedBatch.imageUrl,S)}}function Ce(s,t){if(s&1){let e=C();i(0,"div",58)(1,"app-button",77),l(2,"translate"),h("click",function(){_(e);let a=p(2);return g(a.approveBatch())}),n(),i(3,"app-button",78),l(4,"translate"),h("click",function(){_(e);let a=p(2);return g(a.showRejectForm())}),n()()}if(s&2){let e=p(2);r(),B("label",d(2,3,"BATCH.APPROVE")),u("loading",e.isLoading),r(2),B("label",d(4,5,"BATCH.REJECT"))}}function be(s,t){if(s&1){let e=C();i(0,"div",64)(1,"div",65)(2,"app-button",66),h("click",function(){_(e);let a=p();return g(a.backToTable())}),n(),i(3,"h2")(4,"i",67),o(5,"inventory_2"),n(),o(6),l(7,"translate"),n()(),i(8,"div",68)(9,"div",69)(10,"div",70)(11,"label")(12,"i",22),o(13,"qr_code"),n(),o(14),l(15,"translate"),n(),i(16,"div",71),o(17),n()(),i(18,"div",70)(19,"label")(20,"i",22),o(21,"straighten"),n(),o(22),l(23,"translate"),n(),i(24,"div",71),o(25),n()(),i(26,"div",70)(27,"label")(28,"i",22),o(29,"person"),n(),o(30),l(31,"translate"),n(),i(32,"div",71),o(33),n()(),i(34,"div",70)(35,"label")(36,"i",22),o(37,"attach_money"),n(),o(38),l(39,"translate"),n(),i(40,"div",71),o(41),n()(),i(42,"div",70)(43,"label")(44,"i",22),o(45,"category"),n(),o(46),l(47,"translate"),n(),i(48,"div",71),o(49),n()(),i(50,"div",70)(51,"label")(52,"i",22),o(53,"note"),n(),o(54),l(55,"translate"),n(),i(56,"div",71),o(57),l(58,"translate"),n()(),i(59,"div",70)(60,"label")(61,"i",22),o(62,"palette"),n(),o(63),l(64,"translate"),n(),i(65,"div",71),o(66),n()(),i(67,"div",70)(68,"label")(69,"i",22),o(70,"calendar_today"),n(),o(71),l(72,"translate"),n(),i(73,"div",71),o(74),l(75,"date"),n()()(),b(76,xe,9,7,"div",72)(77,Ce,5,7,"div",73),n()()}if(s&2){let e=p();r(6),j(" ",d(7,21,"BATCH.BATCH_DETAIL")," ",e.selectedBatch.code," \u2013 ",e.selectedBatch.client," "),r(8),f(" ",d(15,23,"BATCH.BATCH_CODE"),": "),r(3),v(e.selectedBatch.code),r(5),f(" ",d(23,25,"BATCH.QUANTITY"),": "),r(3),f("",e.selectedBatch.quantity,"m"),r(5),f(" ",d(31,27,"BATCH.CLIENT"),": "),r(3),v(e.selectedBatch.client),r(5),f(" ",d(39,29,"BATCH.PRICE"),": "),r(3),f("s/",e.selectedBatch.price,""),r(5),f(" ",d(47,31,"BATCH.FABRIC_TYPE"),": "),r(3),v(e.selectedBatch.fabricType),r(5),f(" ",d(55,33,"BATCH.OBSERVATIONS"),": "),r(3),v(e.selectedBatch.observations||d(58,35,"BATCH.NO_OBSERVATIONS")),r(6),f(" ",d(64,37,"BATCH.COLOR"),": "),r(3),v(e.selectedBatch.color),r(5),f(" ",d(72,39,"BATCH.REGISTER_DATE"),": "),r(3),v(V(75,41,e.selectedBatch.date,"dd/MM/yyyy")),r(2),u("ngIf",e.selectedBatch.imageUrl),r(),u("ngIf",e.canApproveOrReject(e.selectedBatch))}}function Be(s,t){if(s&1){let e=C();i(0,"div",96),I(1,"img",97),l(2,"translate"),i(3,"div",98)(4,"button",99),h("click",function(a){_(e);let m=p(2);return g(m.removeImage(a))}),i(5,"i",22),o(6,"close"),n()()()()}if(s&2){let e=p(2);r(),u("src",e.rejectImage,S)("alt",d(2,2,"BATCH.PREVIEW"))}}function we(s,t){s&1&&(i(0,"div",100)(1,"i",101),o(2,"cloud_upload"),n(),i(3,"p",102),o(4),l(5,"translate"),n(),i(6,"p",103),o(7),l(8,"translate"),n()()),s&2&&(r(4),v(d(5,2,"BATCH.DRAG_DROP_IMAGE")),r(3),v(d(8,4,"BATCH.OR_CLICK_SELECT")))}function Oe(s,t){if(s&1){let e=C();i(0,"div",79)(1,"div",65)(2,"app-button",66),h("click",function(){_(e);let a=p();return g(a.view="detail")}),n(),i(3,"h2")(4,"i",80),o(5,"report_problem"),n(),o(6),l(7,"translate"),n()(),i(8,"div",81)(9,"div",82)(10,"i",22),o(11,"warning"),n(),i(12,"p"),o(13),l(14,"translate"),n()(),i(15,"div",83)(16,"div",84)(17,"label")(18,"i",22),o(19,"edit_note"),n(),o(20),l(21,"translate"),i(22,"span",85),o(23,"*"),n()(),i(24,"app-input",86),l(25,"translate"),A("ngModelChange",function(a){_(e);let m=p();return y(m.rejectReason,a)||(m.rejectReason=a),g(a)}),n(),i(26,"div",87),o(27),n()(),i(28,"div",84)(29,"label")(30,"i",22),o(31,"photo_camera"),n(),o(32),l(33,"translate"),i(34,"span",88),o(35),l(36,"translate"),n()(),i(37,"div",89),h("click",function(){_(e);let a=p();return g(a.triggerFileInput())})("dragover",function(a){_(e);let m=p();return g(m.onDragOver(a))})("dragleave",function(a){_(e);let m=p();return g(m.onDragLeave(a))})("drop",function(a){_(e);let m=p();return g(m.onDrop(a))}),i(38,"input",90),h("change",function(a){_(e);let m=p();return g(m.onFileChange(a))}),n(),b(39,Be,7,4,"div",91)(40,we,9,6,"div",92),n()()(),i(41,"div",93)(42,"app-button",94),l(43,"translate"),h("click",function(){_(e);let a=p();return g(a.view="detail")}),n(),i(44,"app-button",95),l(45,"translate"),h("click",function(){_(e);let a=p();return g(a.submitReject())}),n()()()()}if(s&2){let e=p();r(6),f(" ",d(7,17,"BATCH.REJECT_BATCH")," "),r(7),v(d(14,19,"BATCH.REJECT_WARNING")),r(7),f(" ",d(21,21,"BATCH.REJECT_REASON"),": "),r(4),B("placeholder",d(25,23,"BATCH.ENTER_REASON_PLACEHOLDER")),k("ngModel",e.rejectReason),u("fullWidth",!0),r(3),f(" ",e.rejectReason.length||0,"/500 "),r(5),f(" ",d(33,25,"BATCH.EVIDENCE"),": "),r(3),v(d(36,27,"COMMON.OPTIONAL")),r(2),M("has-image",e.rejectImage),r(2),u("ngIf",e.rejectImage),r(),u("ngIf",!e.rejectImage),r(2),B("label",d(43,29,"COMMON.CANCEL")),r(2),B("label",d(45,31,"BATCH.CONFIRM_REJECT")),u("loading",e.isLoading)("disabled",!e.rejectReason||!e.rejectReason.trim())}}var re=class s{constructor(t,e,c,a){this.batchService=t;this.authService=e;this.observationService=c;this.supplierService=a}view="table";batches=[];filteredBatches=[];selectedBatch=null;isCreatingObservation=!1;suppliers=[];currentUserId="";searchTerm="";showQuickFilters=!1;statusFilter=null;sortField="date";sortDirection="desc";isLoading=!1;notification={show:!1,message:"",type:"success"};rejectReason="";rejectImage="";selectedFile=null;createBatchObservation(t){if(this.isCreatingObservation)return;this.isCreatingObservation=!0;let e=new Date().toISOString(),c=new ie({batchId:t.id,batchCode:t.code,businessmanId:this.currentUserId,supplierId:t.supplierId,reason:this.rejectReason,imageUrl:t.imageUrl,status:te.PENDIENTE,createdAt:e});console.log("\u{1F4DD} Creando observaci\xF3n:",c),this.observationService.create(c).subscribe({next:()=>{console.log("\u2705 Observaci\xF3n creada correctamente"),this.isCreatingObservation=!1},error:a=>{console.error("\u274C Error al crear observaci\xF3n:",a),this.isCreatingObservation=!1}})}ngOnInit(){let t=this.authService.getCurrentUser();t&&t.id&&(this.currentUserId=t.id,this.loadBatches(),this.loadSuppliers())}getSupplierCompanyName(t){return this.suppliers.find(c=>c.id===t)?.companyName||"Empresa no encontrada"}loadSuppliers(){this.supplierService.getAllSuppliers().subscribe({next:t=>{this.suppliers=t,console.log("Proveedores cargados:",t)},error:t=>{console.error("Error al cargar proveedores:",t)}})}loadBatches(){this.isLoading=!0,this.batchService.getByBusinessmanId(this.currentUserId).subscribe({next:t=>{console.log("Lotes del businessman:",t),console.log("ID de usuario actual:",this.currentUserId),this.batches=t,this.filteredBatches=[...this.batches],this.filterBatches(),this.isLoading=!1},error:t=>{console.error("Error al cargar lotes:",t),this.showNotification("Error al cargar los lotes","error"),this.isLoading=!1}})}clearSearch(){this.searchTerm="",this.filterBatches()}toggleFilters(){this.showQuickFilters=!this.showQuickFilters}setStatusFilter(t){this.statusFilter=t,this.filterBatches()}filterBatches(){let t=[...this.batches];if(this.searchTerm&&this.searchTerm.trim()){let e=this.searchTerm.toLowerCase().trim();t=t.filter(c=>c.code&&c.code.toLowerCase().includes(e)||c.client&&c.client.toLowerCase().includes(e)||c.fabricType&&c.fabricType.toLowerCase().includes(e)||c.color&&c.color.toLowerCase().includes(e)||c.status&&c.status.toLowerCase().includes(e))}this.statusFilter&&(t=t.filter(e=>e.status===this.statusFilter)),t=this.sortBatches(t),this.filteredBatches=t}sortBy(t){this.sortField===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=t,this.sortDirection="asc"),this.filterBatches()}sortBatches(t){return t.sort((e,c)=>{let a,m;switch(this.sortField){case"code":a=e.code||"",m=c.code||"";break;case"client":a=e.client||"",m=c.client||"";break;case"date":a=new Date(e.date),m=new Date(c.date);break;case"price":a=e.price||0,m=c.price||0;break;default:return 0}return a<m?this.sortDirection==="asc"?-1:1:a>m?this.sortDirection==="asc"?1:-1:0})}trackByBatchId(t,e){return e.id||t.toString()}isUrgentBatch(t){if(t.status!==x.ACEPTADO)return!1;let e=new Date(t.date);return Math.floor((new Date().getTime()-e.getTime())/(1e3*60*60*24))>7}getStatusIcon(t){switch(t){case x.ACEPTADO:return"check_circle";case x.ENVIADO:return"local_shipping";case x.POR_ENVIAR:return"schedule";case x.RECHAZADO:return"cancel";case x.COMPLETADO:return"task_alt";default:return"help"}}viewBatchDetails(t){this.selectedBatch=t,this.view="detail"}backToTable(){this.view="table",this.selectedBatch=null}quickApprove(t){this.canApproveOrReject(t)&&confirm(`\xBFAprobar el lote ${t.code}?`)&&(this.selectedBatch=t,this.approveBatch())}quickReject(t){this.canApproveOrReject(t)&&(this.selectedBatch=t,this.showRejectForm())}approveBatch(){if(!this.selectedBatch)return;this.isLoading=!0;let t={id:this.selectedBatch.id,status:x.COMPLETADO,businessmanId:this.selectedBatch.businessmanId};this.batchService.updateBatch(this.selectedBatch.id,t).subscribe({next:()=>{this.showNotification("Lote aprobado correctamente","success"),this.loadBatches(),this.backToTable()},error:e=>{console.error("Error al aprobar lote:",e),this.showNotification("Error al aprobar el lote","error"),this.isLoading=!1}})}showRejectForm(){this.rejectReason="",this.rejectImage="",this.selectedFile=null,this.view="reject"}onFileChange(t){let e=t.target.files[0];e&&this.handleFileSelection(e)}handleFileSelection(t){t&&t.type.match(/image\/*/)&&t.size<5e6?(this.selectedFile=t,this.readAndCompressImage(t)):t.type.match(/image\/*/)?t.size>=5e6&&this.showNotification("La imagen debe ser menor a 5MB","warning"):this.showNotification("Por favor seleccione solo archivos de imagen","warning")}readAndCompressImage(t){let e=new FileReader;e.onload=c=>{let a=new Image;a.src=c.target.result,a.onload=()=>{let m=document.createElement("canvas"),R=m.getContext("2d"),E=800,T=600,w=a.width,O=a.height;w>O?w>E&&(O*=E/w,w=E):O>T&&(w*=T/O,O=T),m.width=w,m.height=O,R&&(R.drawImage(a,0,0,w,O),this.rejectImage=m.toDataURL("image/jpeg",.7))}},e.readAsDataURL(t)}onDragOver(t){t.preventDefault(),t.stopPropagation(),t.currentTarget.classList.add("drag-over")}onDragLeave(t){t.preventDefault(),t.stopPropagation(),t.currentTarget.classList.remove("drag-over")}onDrop(t){t.preventDefault(),t.stopPropagation(),t.currentTarget.classList.remove("drag-over");let c=t.dataTransfer?.files;if(c&&c.length>0){let a=c[0];this.handleFileSelection(a)}}removeImage(t){t.preventDefault(),t.stopPropagation(),this.rejectImage="",this.selectedFile=null}submitReject(){if(!this.selectedBatch||!this.rejectReason.trim())return;this.isLoading=!0;let t={id:this.selectedBatch.id,status:x.RECHAZADO,businessmanId:this.selectedBatch.businessmanId};this.batchService.updateBatch(this.selectedBatch.id,t).subscribe({next:()=>{this.createBatchObservation(this.selectedBatch),this.showNotification("Lote rechazado correctamente","success"),this.loadBatches(),this.backToTable()},error:e=>{console.error("Error al rechazar lote:",e),this.showNotification("Error al rechazar el lote","error"),this.isLoading=!1}})}openImageModal(t){window.open(t,"_blank")}showNotification(t,e){this.notification={show:!0,message:t,type:e}}getStatusClass(t){switch(t.toLowerCase()){case x.ACEPTADO.toLowerCase():return"status-approved";case x.ENVIADO.toLowerCase():return"status-sent";case x.POR_ENVIAR.toLowerCase():return"status-pending";case x.RECHAZADO.toLowerCase():return"status-rejected";case x.COMPLETADO.toLowerCase():return"status-completed";default:return""}}canApproveOrReject(t){return t.status===x.ACEPTADO}triggerFileInput(){document.getElementById("rejectImage")?.click()}static \u0275fac=function(e){return new(e||s)(P($),P(K),P(ne),P(ae))};static \u0275cmp=H({type:s,selectors:[["app-businessman-batch"]],decls:5,vars:7,consts:[[1,"batch-container"],[4,"ngIf"],["class","detail-view",4,"ngIf"],["class","reject-form",4,"ngIf"],[3,"close","show","message","type","autoClose"],[1,"table-header"],[1,"header-left"],[1,"material-icons","header-icon"],["class","batch-count",4,"ngIf"],[1,"search-container"],[1,"search-input-wrapper"],[1,"material-icons","search-icon"],["type","text",1,"search-input",3,"ngModelChange","input","keyup.enter","placeholder","ngModel"],["class","clear-search",3,"click",4,"ngIf"],["variant","secondary","icon","tune",3,"click","label"],["variant","text","icon","refresh",3,"click","label","loading"],["class","quick-filters",4,"ngIf"],["class","loading-state",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","table-wrapper",4,"ngIf"],[1,"batch-count"],[1,"clear-search",3,"click"],[1,"material-icons"],[1,"quick-filters"],[1,"filter-chips"],[1,"filter-chip",3,"click"],[1,"status-dot","status-sent"],[1,"status-dot","status-approved"],[1,"loading-state"],[1,"skeleton-table"],["class","skeleton-row",4,"ngFor","ngForOf"],[1,"skeleton-row"],[1,"skeleton-cell"],[1,"empty-state"],[1,"empty-icon"],["variant","primary",3,"label","click",4,"ngIf"],["variant","primary",3,"click","label"],[1,"table-wrapper"],[1,"batch-table"],[1,"sortable",3,"click"],[1,"th-content"],[1,"material-icons","sort-icon"],[1,"text-right"],[1,"actions-column"],["class","clickable-row",3,"urgent","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"clickable-row",3,"click"],[1,"code-cell"],[1,"batch-code"],[1,"material-icons","batch-icon"],[1,"supplier-info"],[1,"supplier-name"],[1,"fabric-type"],[1,"date-text"],[1,"status-container"],[1,"status-badge",3,"ngClass"],[1,"material-icons","status-icon"],[1,"price-text"],[1,"actions-cell",3,"click"],[1,"action-buttons"],["class","action-btn approve-btn",3,"title","click",4,"ngIf"],["class","action-btn reject-btn",3,"title","click",4,"ngIf"],[1,"action-btn","view-btn",3,"click","title"],[1,"action-btn","approve-btn",3,"click","title"],[1,"action-btn","reject-btn",3,"click","title"],[1,"detail-view"],[1,"detail-header"],["label","","icon","arrow_back","variant","back",3,"click"],[1,"material-icons","detail-icon"],[1,"detail-content"],[1,"detail-grid"],[1,"detail-item"],[1,"detail-value"],["class","batch-image-container",4,"ngIf"],["class","action-buttons",4,"ngIf"],[1,"batch-image-container"],[1,"image-header"],[1,"batch-image",3,"click","src","alt"],["variant","primary","icon","check_circle",3,"click","label","loading"],["variant","secondary","icon","cancel",3,"click","label"],[1,"reject-form"],[1,"material-icons","reject-icon"],[1,"reject-content"],[1,"reject-warning"],[1,"form-section"],[1,"form-group"],[1,"required"],["type","textarea",3,"ngModelChange","ngModel","placeholder","fullWidth"],[1,"char-counter"],[1,"optional"],[1,"upload-area",3,"click","dragover","dragleave","drop"],["type","file","id","rejectImage","accept","image/*",2,"display","none",3,"change"],["class","image-preview",4,"ngIf"],["class","upload-placeholder",4,"ngIf"],[1,"form-actions"],["variant","text",3,"click","label"],["variant","primary","icon","send",3,"click","label","loading","disabled"],[1,"image-preview"],[1,"preview-image",3,"src","alt"],[1,"image-actions"],[1,"remove-image",3,"click"],[1,"upload-placeholder"],[1,"material-icons","upload-icon"],[1,"upload-text"],[1,"upload-subtext"]],template:function(e,c){e&1&&(i(0,"div",0),b(1,ve,24,20,"div",1)(2,be,78,44,"div",2)(3,Oe,46,33,"div",3),i(4,"app-notification",4),h("close",function(){return c.notification.show=!1}),n()()),e&2&&(r(),u("ngIf",c.view==="table"),r(),u("ngIf",c.view==="detail"&&c.selectedBatch),r(),u("ngIf",c.view==="reject"&&c.selectedBatch),r(),u("show",c.notification.show)("message",c.notification.message)("type",c.notification.type)("autoClose",!0))},dependencies:[U,L,F,N,z,J,G,Y,Q,X,Z,ee,W,q],styles:[".batch-container[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto;padding:1.5rem;min-height:100vh}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;padding:1.5rem;background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000000a;border:1px solid #f0f0f0}.header-left[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin:0;color:#2c3e50;font-size:1.5rem;font-weight:600}.header-icon[_ngcontent-%COMP%]{color:#a68b6b!important;font-size:1.75rem!important}.batch-count[_ngcontent-%COMP%]{background:#a68b6b;color:#fff;padding:.25rem .75rem;border-radius:16px;font-size:.875rem;font-weight:500;margin-left:.5rem}.search-container[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:center}.search-input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;background:#f8f9fa;border:2px solid #e9ecef;border-radius:10px;padding:.75rem 1rem;width:320px;transition:all .2s ease}.search-input-wrapper[_ngcontent-%COMP%]:hover{border-color:#a68b6b;background:#fff}.search-input-wrapper[_ngcontent-%COMP%]:focus-within{border-color:#a68b6b;background:#fff;box-shadow:0 0 0 3px #a68b6b1a}.search-input[_ngcontent-%COMP%]{border:none;outline:none;background:transparent;flex:1;font-size:1rem;color:#495057;margin-left:.5rem;margin-right:.5rem}.search-input[_ngcontent-%COMP%]::placeholder{color:#6c757d}.search-icon[_ngcontent-%COMP%]{color:#6c757d!important;font-size:1.25rem!important;flex-shrink:0}.search-input-wrapper[_ngcontent-%COMP%]:focus-within   .search-icon[_ngcontent-%COMP%]{color:#a68b6b!important}.clear-search[_ngcontent-%COMP%]{background:none;border:none;padding:.25rem;border-radius:4px;cursor:pointer;margin-left:.5rem;color:#6c757d;transition:all .2s ease}.clear-search[_ngcontent-%COMP%]:hover{background:#f8f9fa;color:#495057}.quick-filters[_ngcontent-%COMP%]{margin-bottom:1.5rem;padding:1rem 1.5rem;background:#fff;border-radius:12px;border:1px solid #f0f0f0}.filter-chips[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-wrap:wrap}.filter-chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:#f8f9fa;border:1px solid #e9ecef;border-radius:20px;font-size:.875rem;cursor:pointer;transition:all .2s ease;color:#495057}.filter-chip[_ngcontent-%COMP%]:hover{background:#e9ecef;border-color:#a68b6b}.filter-chip.active[_ngcontent-%COMP%]{background:#a68b6b;color:#fff;border-color:#a68b6b}.filter-chip[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1rem!important;width:1rem!important;height:1rem!important}.loading-state[_ngcontent-%COMP%]{padding:2rem}.skeleton-table[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.skeleton-row[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:1rem;background:#fff;border-radius:8px;border:1px solid #f0f0f0}.skeleton-cell[_ngcontent-%COMP%]{height:20px;background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0,#f0f0f0 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_loading 1.5s infinite;border-radius:4px;flex:1}@keyframes _ngcontent-%COMP%_loading{0%{background-position:200% 0}to{background-position:-200% 0}}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;background:#fff;border-radius:12px;border:2px dashed #e9ecef}.empty-icon[_ngcontent-%COMP%]{margin-bottom:1.5rem}.empty-icon[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:4rem!important;width:4rem!important;height:4rem!important;color:#dee2e6}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#495057;margin-bottom:.5rem;font-weight:600}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6c757d;margin-bottom:2rem}.table-wrapper[_ngcontent-%COMP%]{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px #0000000a;border:1px solid #f0f0f0}.batch-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.batch-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8f9fa;padding:1rem;text-align:left;font-weight:600;color:#495057;border-bottom:2px solid #e9ecef;white-space:nowrap}.batch-table[_ngcontent-%COMP%]   th.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;transition:background-color .2s ease}.batch-table[_ngcontent-%COMP%]   th.sortable[_ngcontent-%COMP%]:hover{background:#e9ecef}.th-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.sort-icon[_ngcontent-%COMP%]{font-size:1rem!important;color:#adb5bd!important;opacity:0;transition:opacity .2s ease}.batch-table[_ngcontent-%COMP%]   th.sortable[_ngcontent-%COMP%]:hover   .sort-icon[_ngcontent-%COMP%]{opacity:1}.batch-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #f8f9fa;vertical-align:middle}.clickable-row[_ngcontent-%COMP%]{cursor:pointer;transition:all .2s ease;position:relative}.clickable-row[_ngcontent-%COMP%]:hover{background:#f8f9fa;transform:translateY(-1px);box-shadow:0 4px 12px #00000014}.clickable-row.urgent[_ngcontent-%COMP%]{border-left:4px solid #ff6b6b}.code-cell[_ngcontent-%COMP%]{min-width:150px}.batch-code[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:600;color:#2c3e50}.batch-icon[_ngcontent-%COMP%]{color:#a68b6b!important;font-size:1.25rem!important}.supplier-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.supplier-name[_ngcontent-%COMP%]{font-weight:500;color:#2c3e50}.fabric-type[_ngcontent-%COMP%]{color:#495057;background:#f8f9fa;padding:.25rem .75rem;border-radius:16px;font-size:.875rem;display:inline-block}.date-text[_ngcontent-%COMP%]{color:#6c757d;font-variant-numeric:tabular-nums}.price-text[_ngcontent-%COMP%]{font-weight:600;color:#28a745;font-variant-numeric:tabular-nums}.text-right[_ngcontent-%COMP%]{text-align:right}.status-container[_ngcontent-%COMP%]{display:flex;align-items:center}.status-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;border-radius:20px;font-size:.875rem;font-weight:500;text-transform:uppercase;letter-spacing:.025em;transition:all .2s ease}.status-badge.large[_ngcontent-%COMP%]{padding:.75rem 1.25rem;font-size:.9rem}.status-icon[_ngcontent-%COMP%]{font-size:1rem!important;width:1rem!important;height:1rem!important}.status-approved[_ngcontent-%COMP%]{background:#d4edda;color:#155724;border:1px solid #c3e6cb}.status-sent[_ngcontent-%COMP%]{background:#cce7ff;color:#004085;border:1px solid #99d3ff}.status-pending[_ngcontent-%COMP%]{background:#fff3cd;color:#856404;border:1px solid #ffeaa7}.status-rejected[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.status-completed[_ngcontent-%COMP%]{background:#e2e3ff;color:#383d9a;border:1px solid #c5c6ff}.actions-column[_ngcontent-%COMP%]{width:140px;text-align:center}.actions-cell[_ngcontent-%COMP%]{padding:.5rem!important}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.25rem;justify-content:center;opacity:0;transition:opacity .2s ease}.clickable-row[_ngcontent-%COMP%]:hover   .action-buttons[_ngcontent-%COMP%]{opacity:1}.action-btn[_ngcontent-%COMP%]{width:32px;height:32px;border:none;border-radius:6px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease;background:#fff;border:1px solid #e9ecef}.action-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1rem!important;width:1rem!important;height:1rem!important}.approve-btn[_ngcontent-%COMP%]{color:#28a745;border-color:#28a745}.approve-btn[_ngcontent-%COMP%]:hover{background:#28a745;color:#fff;transform:scale(1.1)}.reject-btn[_ngcontent-%COMP%]{color:#dc3545;border-color:#dc3545}.reject-btn[_ngcontent-%COMP%]:hover{background:#dc3545;color:#fff;transform:scale(1.1)}.view-btn[_ngcontent-%COMP%]{color:#007bff;border-color:#007bff}.view-btn[_ngcontent-%COMP%]:hover{background:#007bff;color:#fff;transform:scale(1.1)}.detail-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:2rem;background:linear-gradient(135deg,#f8f9fa,#fff);border-bottom:1px solid #e9ecef}.header-info[_ngcontent-%COMP%]{flex:1;margin-left:1rem}.header-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin:0 0 .5rem;color:#2c3e50;font-size:1.5rem;font-weight:600}.header-subtitle[_ngcontent-%COMP%]{color:#6c757d;font-size:1rem;font-weight:500}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center}.detail-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem;margin-bottom:2rem}.detail-card[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #e9ecef;border-radius:12px;overflow:hidden;transition:all .2s ease}.detail-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 16px #0000001a}.detail-view[_ngcontent-%COMP%]{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 16px #00000014;border:1px solid #f0f0f0}.detail-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:2rem;background:linear-gradient(135deg,#f8f9fa,#fff);border-bottom:1px solid #e9ecef}.detail-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin:0 0 0 1rem;color:#2c3e50;font-size:1.5rem;font-weight:600}.detail-icon[_ngcontent-%COMP%]{color:#a68b6b!important;font-size:1.75rem!important}.detail-content[_ngcontent-%COMP%]{padding:2rem}.detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1.5rem;margin-bottom:2rem}.detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.detail-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:600;color:#666;margin-bottom:.5rem}.detail-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1.25rem!important;color:#a68b6b!important}.detail-value[_ngcontent-%COMP%]{font-size:1.1rem;color:#2c3e50;font-weight:500}.batch-image-container[_ngcontent-%COMP%]{width:100%;margin:1.5rem 0;text-align:center}.image-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:1rem;padding:1rem;background:#f8f9fa;border-radius:8px}.image-header[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:#a68b6b!important;font-size:1.25rem!important}.image-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#2c3e50;font-weight:600}.batch-image[_ngcontent-%COMP%]{max-width:100%;max-height:400px;border-radius:8px;box-shadow:0 1px 5px #0000001a;cursor:pointer;transition:all .2s ease}.batch-image[_ngcontent-%COMP%]:hover{transform:scale(1.02);box-shadow:0 8px 25px #00000026}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;margin-top:2rem}.reject-form[_ngcontent-%COMP%]{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 16px #00000014;border:1px solid #f0f0f0}.reject-icon[_ngcontent-%COMP%]{color:#dc3545!important;font-size:1.75rem!important}.reject-content[_ngcontent-%COMP%]{padding:2rem;max-width:800px;margin:0 auto}.reject-warning[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem 1.5rem;background:#fff3cd;border:1px solid #ffeaa7;border-radius:8px;margin-bottom:2rem}.reject-warning[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:#856404!important;font-size:1.5rem!important}.reject-warning[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#856404;font-weight:500}.form-section[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]{margin-bottom:2rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:600;margin-bottom:.75rem;color:#2c3e50}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1.25rem!important;color:#a68b6b!important}.required[_ngcontent-%COMP%]{color:#dc3545;font-weight:700}.optional[_ngcontent-%COMP%]{color:#6c757d;font-weight:400;font-size:.875rem;margin-left:.5rem}.char-counter[_ngcontent-%COMP%]{text-align:right;font-size:.875rem;color:#6c757d;margin-top:.5rem}.upload-area[_ngcontent-%COMP%]{border:2px dashed #dee2e6;border-radius:12px;padding:2rem;text-align:center;cursor:pointer;transition:all .2s ease;background:#f8f9fa;position:relative}.upload-area[_ngcontent-%COMP%]:hover{border-color:#a68b6b;background:#fff;transform:translateY(-2px)}.upload-area.has-image[_ngcontent-%COMP%]{padding:1rem;background:#fff;border-color:#a68b6b}.image-preview[_ngcontent-%COMP%]{position:relative;display:inline-block}.preview-image[_ngcontent-%COMP%]{max-width:100%;max-height:300px;border-radius:8px;display:block}.image-actions[_ngcontent-%COMP%]{position:absolute;top:.5rem;right:.5rem}.remove-image[_ngcontent-%COMP%]{width:32px;height:32px;background:#dc3545e6;color:#fff;border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.remove-image[_ngcontent-%COMP%]:hover{background:#dc3545;transform:scale(1.1)}.upload-placeholder[_ngcontent-%COMP%]{padding:2rem}.upload-icon[_ngcontent-%COMP%]{font-size:3rem!important;width:3rem!important;height:3rem!important;color:#a68b6b!important;margin-bottom:1rem}.upload-text[_ngcontent-%COMP%]{font-weight:600;color:#495057;margin:0 0 .5rem}.upload-subtext[_ngcontent-%COMP%]{color:#6c757d;font-size:.875rem;margin:0}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;padding-top:2rem;border-top:1px solid #e9ecef}@media (max-width: 768px){.batch-container[_ngcontent-%COMP%]{padding:1rem}.table-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:1rem}.search-container[_ngcontent-%COMP%]{width:100%;flex-direction:column}.search-input-wrapper[_ngcontent-%COMP%]{width:100%}.detail-cards[_ngcontent-%COMP%], .detail-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.action-buttons[_ngcontent-%COMP%], .form-actions[_ngcontent-%COMP%]{flex-direction:column}.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}.batch-table[_ngcontent-%COMP%]{min-width:700px}.batch-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(3), .batch-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(3){display:none}}@media (max-width: 480px){.header-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem}.detail-content[_ngcontent-%COMP%], .card-header[_ngcontent-%COMP%], .detail-grid[_ngcontent-%COMP%], .reject-content[_ngcontent-%COMP%]{padding:1rem}.upload-area[_ngcontent-%COMP%]{padding:1.5rem}}"]})};export{re as BusinessmanBatchComponent};
