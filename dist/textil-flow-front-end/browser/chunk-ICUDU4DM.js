import{b as p}from"./chunk-QHSPJAHQ.js";import{C as r,T as l,Z as c,p as u,s as n}from"./chunk-3V6P7TZ6.js";var a=class o{id;userId;userType;language;viewMode;subscriptionPlan;subscriptionStatus;subscriptionStartDate;createdAt;updatedAt;constructor(t){this.id=t.id,this.userId=t.userId,this.userType=t.userType,this.language=t.language,this.viewMode=t.viewMode,this.subscriptionPlan=t.subscriptionPlan,this.subscriptionStatus=t.subscriptionStatus,this.subscriptionStartDate=t.subscriptionStartDate,this.createdAt=t.createdAt,this.updatedAt=t.updatedAt}isCorporateSubscription(){return this.subscriptionPlan==="corporate"}isBasicSubscription(){return this.subscriptionPlan==="basic"||!this.subscriptionPlan}isSubscriptionActive(){return this.subscriptionStatus==="active"}isSubscriptionPending(){return this.subscriptionStatus==="pending"||!this.subscriptionStatus}isSubscriptionExpired(){return this.subscriptionStatus==="expired"}requiresPayment(){return this.isSubscriptionPending()||this.isSubscriptionExpired()}getDisplayLanguage(){switch(this.language){case"es":return"Espa\xF1ol";case"en":return"English";default:return this.language}}getDisplayViewMode(){switch(this.viewMode){case"light":return"Claro";case"dark":return"Oscuro";case"auto":return"Autom\xE1tico";default:return this.viewMode}}getDisplaySubscriptionPlan(){switch(this.subscriptionPlan){case"basic":return"B\xE1sico";case"corporate":return"Corporativo";default:return"B\xE1sico"}}getDisplaySubscriptionStatus(){switch(this.subscriptionStatus){case"active":return"Activa";case"pending":return"Pendiente de Pago";case"expired":return"Expirada";default:return"Pendiente de Pago"}}isValid(){let t=["es","en"],e=["light","dark","auto"],i=["basic","corporate"],s=["pending","active","expired"];return t.includes(this.language)&&e.includes(this.viewMode)&&(this.subscriptionPlan?i.includes(this.subscriptionPlan):!0)&&(this.subscriptionStatus?s.includes(this.subscriptionStatus):!0)}static getLanguageOptions(){return[{value:"es",label:"Espa\xF1ol"},{value:"en",label:"English"}]}static getViewModeOptions(){return[{value:"light",label:"Claro"},{value:"dark",label:"Oscuro"},{value:"auto",label:"Autom\xE1tico"}]}static getSubscriptionPlanOptions(){return[{value:"basic",label:"B\xE1sico"},{value:"corporate",label:"Corporativo"}]}static getSubscriptionStatusOptions(){return[{value:"pending",label:"Pendiente de Pago"},{value:"active",label:"Activa"},{value:"expired",label:"Expirada"}]}static fromBackendData(t,e="businessman"){return new o({id:t.id?.toString(),userId:t.userId?.toString(),userType:e,language:t.language||"es",viewMode:t.viewMode||"auto",subscriptionPlan:t.subscriptionPlan||"basic",subscriptionStatus:t.subscriptionStatus||"pending",subscriptionStartDate:t.subscriptionStartDate,createdAt:t.createdAt,updatedAt:t.updatedAt})}toUpdateRequest(){let t={};return this.language&&(t.language=this.language),this.viewMode&&(t.viewMode=this.viewMode),this.subscriptionPlan&&(t.subscriptionPlan=this.subscriptionPlan),this.subscriptionStatus&&(t.subscriptionStatus=this.subscriptionStatus),t}clone(){return new o({id:this.id,userId:this.userId,userType:this.userType,language:this.language,viewMode:this.viewMode,subscriptionPlan:this.subscriptionPlan,subscriptionStatus:this.subscriptionStatus,subscriptionStartDate:this.subscriptionStartDate,createdAt:this.createdAt,updatedAt:this.updatedAt})}};var g=class o extends p{constructor(){super(),this.resourceEndpoint="/configurations"}getConfigurationByUserId(t){let e=`${this.resourcePath()}?userId=${t}`;return this.http.get(e,this.httpOptions).pipe(n(i=>this.transformBackendToFrontend(i)),r(this.handleError))}updateConfiguration(t,e){if(console.log("\u{1F504} ConfigurationService.updateConfiguration called"),console.log("\u{1F4E4} ID:",t,"(type:",typeof t,")"),console.log("\u{1F4E4} Configuration input:",JSON.stringify(e,null,2)),!e.language||!e.viewMode)return console.error("\u274C FALTAN CAMPOS REQUERIDOS: language y viewMode son obligatorios"),u(()=>new Error("Language y viewMode son requeridos para actualizar configuraci\xF3n"));let i={language:e.language,viewMode:e.viewMode,subscriptionPlan:e.subscriptionPlan||"basic"};return console.log("\u{1F4E4} URL:",`${this.resourcePath()}/${t}`),console.log("\u{1F4E4} Request Body (COMPLETO):",JSON.stringify(i,null,2)),this.http.put(`${this.resourcePath()}/${t}`,i,this.httpOptions).pipe(n(s=>(console.log("\u{1F4E5} Backend Response:",s),this.transformBackendToFrontend(s))),r(s=>(console.error("\u274C UPDATE CONFIGURATION ERROR:"),console.error("   Status:",s.status),console.error("   StatusText:",s.statusText),console.error("   Message:",s.message),console.error("   URL:",`${this.resourcePath()}/${t}`),console.error("   Request Body:",JSON.stringify(i,null,2)),console.error("   Full Error:",s),this.handleError(s))))}updateUserPreferences(t,e,i){return console.log("\u{1F504} updateUserPreferences:",{configId:t,language:e,viewMode:i}),this.updateConfiguration(t,{language:e,viewMode:i})}updateSubscriptionPlanComplete(t,e,i){return console.log("\u{1F504} updateSubscriptionPlanComplete called with:"),console.log("   configId:",t),console.log("   userId:",e),console.log("   subscriptionPlan:",i),this.getConfigurationByUserId(e).pipe(l(s=>(console.log("\u{1F4CB} Configuraci\xF3n actual obtenida:",s),this.updateConfiguration(t,{language:s.language,viewMode:s.viewMode,subscriptionPlan:i}))),r(s=>(console.error("\u274C Error obteniendo configuraci\xF3n actual:",s),console.log("\u{1F504} Intentando con valores por defecto..."),this.updateConfiguration(t,{language:"es",viewMode:"auto",subscriptionPlan:i}))))}updateSubscriptionPlan(t,e){return console.log("\u{1F504} updateSubscriptionPlan - usando valores por defecto"),this.updateConfiguration(t,{language:"es",viewMode:"auto",subscriptionPlan:e})}transformBackendToFrontend(t){return new a({id:t.id?.toString(),userId:t.userId?.toString(),userType:"businessman",language:t.language||"es",viewMode:t.viewMode||"auto",subscriptionPlan:t.subscriptionPlan||"basic",subscriptionStatus:t.subscriptionStatus||"pending",subscriptionStartDate:t.subscriptionStartDate,createdAt:t.createdAt,updatedAt:t.updatedAt})}updateMultiplePreferences(t,e){return console.log("\u{1F504} updateMultiplePreferences:",{configId:t,preferences:e}),this.updateConfiguration(t,e)}hasConfiguration(t){return this.getConfigurationByUserId(t).pipe(n(()=>!0),r(()=>[!1]))}getConfigurationSafe(t){return this.getConfigurationByUserId(t).pipe(r(e=>(console.error("Error al obtener configuraci\xF3n:",e),[null])))}getByUserId(t){let e=parseInt(t,10);return this.getConfigurationByUserId(e)}create(t){return console.warn("\u26A0\uFE0F CREATE no debe usarse - el backend crea configuraciones autom\xE1ticamente"),u(()=>new Error("Las configuraciones se crean autom\xE1ticamente en el backend"))}update(t,e){let i=parseInt(t,10);return this.updateConfiguration(i,e)}requiresPayment(t){return this.getConfigurationByUserId(t).pipe(n(e=>e?e.subscriptionStatus==="pending":!0),r(()=>[!0]))}activateSubscription(t,e){return console.log("\u{1F504} Activating subscription:",{configId:t,subscriptionPlan:e}),this.getConfigurationByUserId(t).pipe(l(i=>{if(!i)return u(()=>new Error("Configuration not found for user ID: "+t));console.log("\u{1F4CB} Configuraci\xF3n actual antes de activar:",i);let s={language:i.language||"es",viewMode:i.viewMode||"auto",subscriptionPlan:e,subscriptionStatus:"active"};return console.log("\u{1F4E4} Activating subscription with body:",s),console.log("\u{1F4E4} URL:",`${this.resourcePath()}/${i.id}`),this.http.put(`${this.resourcePath()}/${i.id}`,s,this.httpOptions)}),n(i=>(console.log("\u2705 Subscription activated successfully:",i),console.log("   Final subscriptionPlan:",i.subscriptionPlan),console.log("   Final subscriptionStatus:",i.subscriptionStatus),this.transformBackendToFrontend(i))),r(i=>(console.error("\u274C Error activating subscription:"),console.error("   Status:",i.status),console.error("   Message:",i.message),console.error("   Error:",i),this.handleError(i))))}getSubscriptionStatus(t){return this.getConfigurationByUserId(t).pipe(n(e=>e?.subscriptionStatus||"pending"),r(()=>["pending"]))}hasActiveSubscription(t){return this.getConfigurationByUserId(t).pipe(n(e=>e?e.subscriptionStatus==="active":!1),r(()=>[!1]))}static \u0275fac=function(e){return new(e||o)};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};export{a,g as b};
