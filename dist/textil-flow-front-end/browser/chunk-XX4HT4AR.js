import{a as K}from"./chunk-VLWOHTJQ.js";import{a as S}from"./chunk-R7SPCFOW.js";import{a as J}from"./chunk-QJN4MAFU.js";import{f as q}from"./chunk-7B7PG3YE.js";import{R as H,g as V,j as D,p as B}from"./chunk-XXRYAUWQ.js";import{a as W}from"./chunk-FVAGXBDX.js";import"./chunk-XZSHE36Q.js";import{C as F,x as U,z as k}from"./chunk-S4BAPOHJ.js";import{a as j}from"./chunk-GUHNDTYU.js";import{d as P,e as E,k as L,s as R,u as G,w as z}from"./chunk-Z3ABZYYA.js";import"./chunk-GNQ3TXIC.js";import{$b as g,Fb as o,Gb as n,Hb as N,Lb as _,Pb as h,Qb as u,_a as e,ac as C,bc as b,db as v,e as I,ec as T,fc as w,gc as y,kb as x,la as f,lc as l,ma as m,mc as p,pb as O,wb as c,yb as M,zb as A}from"./chunk-LJ6G2VOH.js";function X(a,i){a&1&&(o(0,"div",4),g(1),l(2,"translate"),n()),a&2&&(e(),b(" ",p(2,1,"COMMON.LOADING")," "))}function Y(a,i){if(a&1){let t=_();o(0,"div",16)(1,"button",17),h("click",function(){let s=f(t).$implicit,d=u(2);return m(d.changeLanguage(s.value))}),g(2),n()()}if(a&2){let t=i.$implicit,r=u(2);e(),M("active",r.configuration.language===t.value),e(),b(" ",t.label," ")}}function Z(a,i){if(a&1){let t=_();o(0,"div")(1,"h2"),g(2),l(3,"translate"),n(),o(4,"div",5)(5,"label"),g(6),l(7,"translate"),n(),o(8,"div",6),O(9,Y,3,3,"div",7),n()(),o(10,"div",5)(11,"app-input",8),l(12,"translate"),y("ngModelChange",function(s){f(t);let d=u();return w(d.configuration.batchCodeFormat,s)||(d.configuration.batchCodeFormat=s),m(s)}),n()(),o(13,"div",5)(14,"label"),g(15),l(16,"translate"),n(),N(17,"app-theme-switcher",9),n(),o(18,"div",5)(19,"label"),g(20),l(21,"translate"),n(),o(22,"div",10)(23,"span",11),g(24),l(25,"translate"),n(),o(26,"button",12),g(27),l(28,"translate"),n()()(),o(29,"div",13)(30,"app-button",14),l(31,"translate"),h("click",function(){f(t);let s=u();return m(s.saveConfiguration())}),n(),o(32,"app-button",15),l(33,"translate"),h("click",function(){f(t);let s=u();return m(s.cancel())}),n()()()}if(a&2){let t=u();e(2),C(p(3,19,"CONFIGURATION.TITLE")),e(4),C(p(7,21,"CONFIGURATION.LANGUAGE")),e(3),c("ngForOf",t.languageOptions),e(2),c("label",p(12,23,"CONFIGURATION.BATCH_CODE"))("options",t.batchCodeOptions),T("ngModel",t.configuration.batchCodeFormat),c("fullWidth",!0),e(4),C(p(16,25,"CONFIGURATION.VIEW_MODE")),e(2),c("showLabels",!0)("fullWidth",!0),e(3),C(p(21,27,"CONFIGURATION.SUBSCRIPTION")),e(3),A("plan-"+t.configuration.subscriptionPlan),e(),b(" ",p(25,29,"PLANS."+((t.configuration.subscriptionPlan==null?null:t.configuration.subscriptionPlan.toUpperCase())||"BASIC"))," "),e(3),b(" ",p(28,31,"CONFIGURATION.MANAGE_PLAN")," "),e(3),c("label",p(31,33,"COMMON.SAVE"))("loading",t.isLoading),e(2),c("label",p(33,35,"COMMON.CANCEL"))("disabled",t.isLoading)}}function $(a,i){if(a&1){let t=_();o(0,"app-notification",18),h("close",function(){f(t);let s=u();return m(s.notification.show=!1)}),n()}if(a&2){let t=u();c("message",t.notification.message)("type",t.notification.type)}}var Q=class a{constructor(i,t,r,s){this.configurationService=i;this.authService=t;this.themeService=r;this.translateService=s;this.translateService.addLangs(["es","en"]),this.translateService.setDefaultLang("es"),this.translateService.use("es"),this.subscriptions.add(this.translateService.get(["CONFIGURATION.AUTOMATIC","CONFIGURATION.MANUAL"]).subscribe(d=>{console.log("Traducciones cargadas:",d)},d=>{console.error("Error al cargar traducciones:",d)}))}currentUserId="";configuration=null;languageOptions=[{label:"Espa\xF1ol",value:"es"},{label:"English",value:"en"}];batchCodeOptions=[{label:"Autom\xE1tico",value:"automatic"},{label:"Manual",value:"manual"}];isLoading=!1;notification={show:!1,message:"",type:"success"};subscriptions=new I;ngOnInit(){let i=this.authService.getCurrentUser();i&&i.id&&(this.currentUserId=i.id,this.loadConfiguration());let t=localStorage.getItem("userLanguage");t&&this.translateService.getLangs().includes(t)&&(this.translateService.use(t),this.updateTranslatedOptions())}ngOnDestroy(){this.subscriptions.unsubscribe()}changeLanguage(i){this.translateService.use(i),localStorage.setItem("userLanguage",i),this.configuration&&(this.configuration.language=i),this.updateTranslatedOptions()}updateTranslatedOptions(){let i=this.translateService.instant("CONFIGURATION.AUTOMATIC"),t=this.translateService.instant("CONFIGURATION.MANUAL");this.batchCodeOptions=[{label:i!=="CONFIGURATION.AUTOMATIC"?i:"Autom\xE1tico",value:"automatic"},{label:t!=="CONFIGURATION.MANUAL"?t:"Manual",value:"manual"}]}loadConfiguration(){this.isLoading=!0,this.configurationService.getByUserId(this.currentUserId).subscribe({next:i=>{Array.isArray(i)&&i.length>0?(this.configuration=i[0],this.applyConfigurationSettings()):Array.isArray(i)?(this.configuration=new S({userId:this.currentUserId,userType:"supplier",language:"es",batchCodeFormat:"automatic",viewMode:"auto",createdAt:new Date().toISOString(),subscriptionPlan:"basic",subscriptionStartDate:new Date().toISOString()}),this.saveConfiguration()):(this.configuration=i,this.applyConfigurationSettings()),this.isLoading=!1},error:i=>{console.error("Error al cargar configuraci\xF3n:",i),this.showNotification(this.translateService.instant("CONFIGURATION.ERROR_LOAD"),"error"),this.isLoading=!1,this.configuration=new S({userId:this.currentUserId,userType:"supplier",language:"es",batchCodeFormat:"automatic",viewMode:"auto",createdAt:new Date().toISOString(),subscriptionPlan:"basic",subscriptionStartDate:new Date().toISOString()})}})}applyConfigurationSettings(){this.configuration&&(this.configuration.language&&this.changeLanguage(this.configuration.language),this.configuration.viewMode&&this.themeService.syncFromConfiguration(this.configuration.viewMode))}saveConfiguration(){this.configuration&&(this.isLoading=!0,this.configuration.viewMode=this.themeService.getThemeForConfiguration(),this.configuration.updatedAt=new Date().toISOString(),this.configuration.id?this.configurationService.update(this.configuration.id,this.configuration).subscribe({next:()=>{this.showNotification(this.translateService.instant("CONFIGURATION.SUCCESS_SAVE"),"success"),this.isLoading=!1},error:i=>{console.error("Error al guardar configuraci\xF3n:",i),this.showNotification(this.translateService.instant("CONFIGURATION.ERROR_SAVE"),"error"),this.isLoading=!1}}):this.configurationService.create(this.configuration).subscribe({next:i=>{this.configuration=i,this.showNotification(this.translateService.instant("CONFIGURATION.SUCCESS_SAVE"),"success"),this.isLoading=!1},error:i=>{console.error("Error al crear configuraci\xF3n:",i),this.showNotification(this.translateService.instant("CONFIGURATION.ERROR_SAVE"),"error"),this.isLoading=!1}}))}cancel(){this.loadConfiguration()}showNotification(i,t){this.notification={show:!0,message:i,type:t}}static \u0275fac=function(t){return new(t||a)(v(W),v(z),v(j),v(U))};static \u0275cmp=x({type:a,selectors:[["app-supplier-configuration"]],decls:4,vars:3,consts:[[1,"configuration-container"],["class","loading-indicator",4,"ngIf"],[4,"ngIf"],[3,"message","type","close",4,"ngIf"],[1,"loading-indicator"],[1,"form-group"],[1,"language-options"],["class","language-option",4,"ngFor","ngForOf"],["type","select",3,"ngModelChange","label","options","ngModel","fullWidth"],["variant","buttons","size","medium",3,"showLabels","fullWidth"],[1,"subscription-info"],[1,"plan-badge"],["routerLink","/supplier/planes",1,"manage-plan-btn"],[1,"button-container"],["variant","primary",3,"click","label","loading"],["variant","secondary",3,"click","label","disabled"],[1,"language-option"],[1,"language-button",3,"click"],[3,"close","message","type"]],template:function(t,r){t&1&&(o(0,"div",0),O(1,X,3,3,"div",1)(2,Z,34,37,"div",2)(3,$,1,2,"app-notification",3),n()),t&2&&(e(),c("ngIf",r.isLoading),e(),c("ngIf",!r.isLoading&&r.configuration),e(),c("ngIf",r.notification.show))},dependencies:[L,P,E,B,V,D,q,H,J,K,F,k,G,R],styles:[".configuration-container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:500;color:#333}.language-options[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:10px}.language-button[_ngcontent-%COMP%]{padding:8px 16px;background-color:#f5f5f5;border:1px solid #ddd;border-radius:4px;cursor:pointer;transition:all .3s;color:#333}.language-button[_ngcontent-%COMP%]:hover{background-color:#e8e8e8}.language-button.active[_ngcontent-%COMP%]{background-color:#866c52;color:#fff;border-color:#866c52}.button-container[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:20px}.loading-indicator[_ngcontent-%COMP%]{text-align:center;padding:20px;color:#666}[data-theme=dark][_ngcontent-%COMP%]   .configuration-container[_ngcontent-%COMP%]{background-color:var(--background-color)}[data-theme=dark][_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--text-dark)}[data-theme=dark][_ngcontent-%COMP%]   .language-button[_ngcontent-%COMP%]{background-color:var(--surface-color);border:1px solid var(--border-color);color:var(--text-dark)}[data-theme=dark][_ngcontent-%COMP%]   .language-button[_ngcontent-%COMP%]:hover{background-color:var(--border-color)}[data-theme=dark][_ngcontent-%COMP%]   .language-button.active[_ngcontent-%COMP%]{background-color:var(--primary-color);color:var(--background-color);border-color:var(--primary-color)}[data-theme=dark][_ngcontent-%COMP%]   .loading-indicator[_ngcontent-%COMP%]{color:var(--text-light)}.subscription-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.plan-badge[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;font-size:.85rem;font-weight:500}.plan-basic[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151}.plan-corporate[_ngcontent-%COMP%]{background:#963;color:#fff}.manage-plan-btn[_ngcontent-%COMP%]{padding:6px 12px;background:transparent;color:var(--primary-color);border:1px solid var(--primary-color);border-radius:6px;font-size:.85rem;cursor:pointer;transition:all .2s}.manage-plan-btn[_ngcontent-%COMP%]:hover{background:var(--primary-color);color:#fff}"]})};export{Q as SupplierConfigurationComponent};
