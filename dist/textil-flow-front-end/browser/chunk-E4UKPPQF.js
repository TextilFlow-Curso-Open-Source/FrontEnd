import{a as ne,b as re,c as ae}from"./chunk-YLOHOSPG.js";import{a as te,b as x}from"./chunk-7E74X2WU.js";import{a as ie}from"./chunk-QJN4MAFU.js";import{f as ee}from"./chunk-7B7PG3YE.js";import{R as $,c as Y,g as Q,j as J,p as K}from"./chunk-XXRYAUWQ.js";import{b as Z}from"./chunk-L5EZL6XB.js";import"./chunk-XZSHE36Q.js";import{C as G,z as W}from"./chunk-S4BAPOHJ.js";import{c as F,d as N,e as z,i as U,k as q,w as X}from"./chunk-Z3ABZYYA.js";import"./chunk-GNQ3TXIC.js";import{$b as c,Fb as i,Gb as n,Hb as k,Lb as C,Pb as f,Qb as p,Tb as B,Ya as I,_a as a,a as S,ac as v,bc as h,db as P,dc as D,ec as y,fc as A,gc as V,jc as L,kb as H,la as _,lc as l,ma as g,mc as d,nc as R,pb as b,wb as u,yb as M}from"./chunk-LJ6G2VOH.js";var ce=()=>[1,2,3,4,5];function se(s,t){if(s&1&&(i(0,"span",20),c(1),n()),s&2){let e=p(2);a(),h("(",e.filteredBatches.length,")")}}function le(s,t){if(s&1){let e=C();i(0,"button",21),f("click",function(){_(e);let r=p(2);return g(r.clearSearch())}),i(1,"i",22),c(2,"close"),n()()}}function de(s,t){if(s&1){let e=C();i(0,"div",23)(1,"div",24)(2,"button",25),f("click",function(){_(e);let r=p(2);return g(r.setStatusFilter(null))}),i(3,"i",22),c(4,"select_all"),n(),c(5),l(6,"translate"),n(),i(7,"button",25),f("click",function(){_(e);let r=p(2);return g(r.setStatusFilter("Enviado"))}),i(8,"span",26),c(9,"\u25CF"),n(),c(10),l(11,"translate"),n(),i(12,"button",25),f("click",function(){_(e);let r=p(2);return g(r.setStatusFilter("Aceptado"))}),i(13,"span",27),c(14,"\u25CF"),n(),c(15),l(16,"translate"),n()()()}if(s&2){let e=p(2);a(2),M("active",!e.statusFilter),a(3),h(" ",d(6,9,"BATCH.ALL_STATUSES")," "),a(2),M("active",e.statusFilter==="Enviado"),a(3),h(" ",d(11,11,"BATCH.STATUS_SENT")," "),a(2),M("active",e.statusFilter==="Aceptado"),a(3),h(" ",d(16,13,"BATCH.STATUS_ACCEPTED")," ")}}function pe(s,t){s&1&&(i(0,"div",31),k(1,"div",32)(2,"div",32)(3,"div",32)(4,"div",32)(5,"div",32)(6,"div",32),n())}function me(s,t){s&1&&(i(0,"div",28)(1,"div",29),b(2,pe,7,0,"div",30),n()()),s&2&&(a(2),u("ngForOf",L(1,ce)))}function _e(s,t){if(s&1){let e=C();i(0,"app-button",36),l(1,"translate"),f("click",function(){_(e);let r=p(3);return g(r.clearSearch())}),n()}s&2&&B("label",d(1,1,"BATCH.CLEAR_SEARCH"))}function ge(s,t){if(s&1&&(i(0,"div",33)(1,"div",34)(2,"i",22),c(3,"inventory_2"),n()(),i(4,"h3"),c(5),l(6,"translate"),l(7,"translate"),n(),i(8,"p"),c(9),l(10,"translate"),l(11,"translate"),n(),b(12,_e,2,3,"app-button",35),n()),s&2){let e=p(2);a(5),v(e.searchTerm?d(6,3,"BATCH.NO_MATCHING_BATCHES"):d(7,5,"BATCH.NO_BATCHES_YET")),a(4),v(e.searchTerm?d(10,7,"BATCH.TRY_DIFFERENT_SEARCH"):d(11,9,"BATCH.START_MANAGING_BATCHES")),a(3),u("ngIf",e.searchTerm)}}function ue(s,t){if(s&1){let e=C();i(0,"button",62),l(1,"translate"),f("click",function(){_(e);let r=p().$implicit,m=p(3);return g(m.quickApprove(r))}),i(2,"i",22),c(3,"check_circle"),n()()}s&2&&u("title",d(1,1,"BATCH.QUICK_APPROVE"))}function fe(s,t){if(s&1){let e=C();i(0,"button",63),l(1,"translate"),f("click",function(){_(e);let r=p().$implicit,m=p(3);return g(m.quickReject(r))}),i(2,"i",22),c(3,"cancel"),n()()}s&2&&u("title",d(1,1,"BATCH.QUICK_REJECT"))}function he(s,t){if(s&1){let e=C();i(0,"tr",45),f("click",function(){let r=_(e).$implicit,m=p(3);return g(m.viewBatchDetails(r))}),i(1,"td",46)(2,"div",47)(3,"i",48),c(4,"qr_code"),n(),i(5,"strong"),c(6),n()()(),i(7,"td")(8,"div",49)(9,"span",50),c(10),n()()(),i(11,"td")(12,"span",51),c(13),n()(),i(14,"td")(15,"span",52),c(16),l(17,"date"),n()(),i(18,"td")(19,"div",53)(20,"span",54)(21,"i",55),c(22),n(),c(23),n()()(),i(24,"td",42)(25,"span",56),c(26),n()(),i(27,"td",57),f("click",function(r){return _(e),g(r.stopPropagation())}),i(28,"div",58),b(29,ue,4,3,"button",59)(30,fe,4,3,"button",60),i(31,"button",61),l(32,"translate"),f("click",function(){let r=_(e).$implicit,m=p(3);return g(m.viewBatchDetails(r))}),i(33,"i",22),c(34,"visibility"),n()()()()()}if(s&2){let e=t.$implicit,o=p(3);M("urgent",o.isUrgentBatch(e)),a(6),v(e.code||"N/A"),a(4),v(o.getSupplierCompanyName(e.supplierId)),a(3),v(e.fabricType||"N/A"),a(3),v(R(17,13,e.date,"dd/MM/yy")),a(4),u("ngClass",o.getStatusClass(e.status)),a(2),v(o.getStatusIcon(e.status)),a(),h(" ",e.status||"N/A"," "),a(3),h("s/",e.price||"N/A",""),a(3),u("ngIf",o.canApproveOrReject(e)),a(),u("ngIf",o.canApproveOrReject(e)),a(),u("title",d(32,16,"BATCH.VIEW_DETAILS"))}}function ve(s,t){if(s&1){let e=C();i(0,"div",37)(1,"table",38)(2,"thead")(3,"tr")(4,"th",39),f("click",function(){_(e);let r=p(2);return g(r.sortBy("code"))}),i(5,"div",40),c(6),l(7,"translate"),i(8,"i",41),c(9,"swap_vert"),n()()(),i(10,"th",39),f("click",function(){_(e);let r=p(2);return g(r.sortBy("client"))}),i(11,"div",40),c(12),l(13,"translate"),i(14,"i",41),c(15,"swap_vert"),n()()(),i(16,"th"),c(17),l(18,"translate"),n(),i(19,"th",39),f("click",function(){_(e);let r=p(2);return g(r.sortBy("date"))}),i(20,"div",40),c(21),l(22,"translate"),i(23,"i",41),c(24,"swap_vert"),n()()(),i(25,"th"),c(26),l(27,"translate"),n(),i(28,"th",42),c(29),l(30,"translate"),n(),i(31,"th",43),c(32),l(33,"translate"),n()()(),i(34,"tbody"),b(35,he,35,18,"tr",44),n()()()}if(s&2){let e=p(2);a(6),h(" ",d(7,9,"BATCH.BATCH_CODE")," "),a(6),h(" ",d(13,11,"BATCH.SUPPLIER")," "),a(5),v(d(18,13,"BATCH.FABRIC_TYPE")),a(4),h(" ",d(22,15,"BATCH.DATE")," "),a(5),v(d(27,17,"BATCH.STATUS")),a(3),v(d(30,19,"BATCH.PRICE")),a(3),v(d(33,21,"COMMON.ACTIONS")),a(3),u("ngForOf",e.filteredBatches)("ngForTrackBy",e.trackByBatchId)}}function xe(s,t){if(s&1){let e=C();i(0,"div")(1,"div",5)(2,"div",6)(3,"h2")(4,"i",7),c(5,"inventory_2"),n(),c(6),l(7,"translate"),b(8,se,2,1,"span",8),n()(),i(9,"div",9)(10,"div",10)(11,"i",11),c(12,"search"),n(),i(13,"input",12),l(14,"translate"),V("ngModelChange",function(r){_(e);let m=p();return A(m.searchTerm,r)||(m.searchTerm=r),g(r)}),f("input",function(){_(e);let r=p();return g(r.filterBatches())})("keyup.enter",function(){_(e);let r=p();return g(r.filterBatches())}),n(),b(15,le,3,0,"button",13),n(),i(16,"app-button",14),l(17,"translate"),f("click",function(){_(e);let r=p();return g(r.toggleFilters())}),n(),i(18,"app-button",15),l(19,"translate"),f("click",function(){_(e);let r=p();return g(r.loadBatches())}),n()()(),b(20,de,17,15,"div",16)(21,me,3,2,"div",17)(22,ge,13,11,"div",18)(23,ve,36,23,"div",19),n()}if(s&2){let e=p();a(6),h(" ",d(7,12,"BATCH.MY_BATCHES")," "),a(2),u("ngIf",!e.isLoading),a(5),B("placeholder",d(14,14,"BATCH.SEARCH_PLACEHOLDER")),y("ngModel",e.searchTerm),a(2),u("ngIf",e.searchTerm),a(),B("label",d(17,16,"COMMON.FILTER")),a(2),B("label",d(19,18,"COMMON.REFRESH")),u("loading",e.isLoading),a(2),u("ngIf",e.showQuickFilters),a(),u("ngIf",e.isLoading),a(),u("ngIf",!e.isLoading&&e.filteredBatches.length===0),a(),u("ngIf",!e.isLoading&&e.filteredBatches.length>0)}}function Ce(s,t){if(s&1){let e=C();i(0,"div",74)(1,"div",75)(2,"i",22),c(3,"image"),n(),i(4,"h3"),c(5),l(6,"translate"),n()(),i(7,"img",76),l(8,"translate"),f("click",function(){_(e);let r=p(2);return g(r.openImageModal(r.selectedBatch.imageUrl))}),n()()}if(s&2){let e=p(2);a(5),v(d(6,3,"BATCH.BATCH_IMAGE")),a(2),B("alt",d(8,5,"BATCH.BATCH_IMAGE")),u("src",e.selectedBatch.imageUrl,I)}}function be(s,t){if(s&1){let e=C();i(0,"div",58)(1,"app-button",77),l(2,"translate"),f("click",function(){_(e);let r=p(2);return g(r.approveBatch())}),n(),i(3,"app-button",78),l(4,"translate"),f("click",function(){_(e);let r=p(2);return g(r.showRejectForm())}),n()()}if(s&2){let e=p(2);a(),B("label",d(2,3,"BATCH.APPROVE")),u("loading",e.isLoading),a(2),B("label",d(4,5,"BATCH.REJECT"))}}function Be(s,t){if(s&1){let e=C();i(0,"div",64)(1,"div",65)(2,"app-button",66),f("click",function(){_(e);let r=p();return g(r.backToTable())}),n(),i(3,"h2")(4,"i",67),c(5,"inventory_2"),n(),c(6),l(7,"translate"),n()(),i(8,"div",68)(9,"div",69)(10,"div",70)(11,"label")(12,"i",22),c(13,"qr_code"),n(),c(14),l(15,"translate"),n(),i(16,"div",71),c(17),n()(),i(18,"div",70)(19,"label")(20,"i",22),c(21,"straighten"),n(),c(22),l(23,"translate"),n(),i(24,"div",71),c(25),n()(),i(26,"div",70)(27,"label")(28,"i",22),c(29,"person"),n(),c(30),l(31,"translate"),n(),i(32,"div",71),c(33),n()(),i(34,"div",70)(35,"label")(36,"i",22),c(37,"attach_money"),n(),c(38),l(39,"translate"),n(),i(40,"div",71),c(41),n()(),i(42,"div",70)(43,"label")(44,"i",22),c(45,"category"),n(),c(46),l(47,"translate"),n(),i(48,"div",71),c(49),n()(),i(50,"div",70)(51,"label")(52,"i",22),c(53,"note"),n(),c(54),l(55,"translate"),n(),i(56,"div",71),c(57),l(58,"translate"),n()(),i(59,"div",70)(60,"label")(61,"i",22),c(62,"palette"),n(),c(63),l(64,"translate"),n(),i(65,"div",71),c(66),n()(),i(67,"div",70)(68,"label")(69,"i",22),c(70,"calendar_today"),n(),c(71),l(72,"translate"),n(),i(73,"div",71),c(74),l(75,"date"),n()()(),b(76,Ce,9,7,"div",72)(77,be,5,7,"div",73),n()()}if(s&2){let e=p();a(6),D(" ",d(7,21,"BATCH.BATCH_DETAIL")," ",e.selectedBatch.code," \u2013 ",e.selectedBatch.client," "),a(8),h(" ",d(15,23,"BATCH.BATCH_CODE"),": "),a(3),v(e.selectedBatch.code),a(5),h(" ",d(23,25,"BATCH.QUANTITY"),": "),a(3),h("",e.selectedBatch.quantity,"m"),a(5),h(" ",d(31,27,"BATCH.CLIENT"),": "),a(3),v(e.selectedBatch.client),a(5),h(" ",d(39,29,"BATCH.PRICE"),": "),a(3),h("s/",e.selectedBatch.price,""),a(5),h(" ",d(47,31,"BATCH.FABRIC_TYPE"),": "),a(3),v(e.selectedBatch.fabricType),a(5),h(" ",d(55,33,"BATCH.OBSERVATIONS"),": "),a(3),v(e.selectedBatch.observations||d(58,35,"BATCH.NO_OBSERVATIONS")),a(6),h(" ",d(64,37,"BATCH.COLOR"),": "),a(3),v(e.selectedBatch.color),a(5),h(" ",d(72,39,"BATCH.REGISTER_DATE"),": "),a(3),v(R(75,41,e.selectedBatch.date,"dd/MM/yyyy")),a(2),u("ngIf",e.selectedBatch.imageUrl),a(),u("ngIf",e.canApproveOrReject(e.selectedBatch))}}function we(s,t){if(s&1){let e=C();i(0,"div",96),k(1,"img",97),l(2,"translate"),i(3,"div",98)(4,"button",99),f("click",function(r){_(e);let m=p(2);return g(m.removeImage(r))}),i(5,"i",22),c(6,"close"),n()()()()}if(s&2){let e=p(2);a(),u("src",e.rejectImage,I)("alt",d(2,2,"BATCH.PREVIEW"))}}function Oe(s,t){s&1&&(i(0,"div",100)(1,"i",101),c(2,"cloud_upload"),n(),i(3,"p",102),c(4),l(5,"translate"),n(),i(6,"p",103),c(7),l(8,"translate"),n()()),s&2&&(a(4),v(d(5,2,"BATCH.DRAG_DROP_IMAGE")),a(3),v(d(8,4,"BATCH.OR_CLICK_SELECT")))}function Me(s,t){if(s&1){let e=C();i(0,"div",79)(1,"div",65)(2,"app-button",66),f("click",function(){_(e);let r=p();return g(r.view="detail")}),n(),i(3,"h2")(4,"i",80),c(5,"report_problem"),n(),c(6),l(7,"translate"),n()(),i(8,"div",81)(9,"div",82)(10,"i",22),c(11,"warning"),n(),i(12,"p"),c(13),l(14,"translate"),n()(),i(15,"div",83)(16,"div",84)(17,"label")(18,"i",22),c(19,"edit_note"),n(),c(20),l(21,"translate"),i(22,"span",85),c(23,"*"),n()(),i(24,"app-input",86),l(25,"translate"),V("ngModelChange",function(r){_(e);let m=p();return A(m.rejectReason,r)||(m.rejectReason=r),g(r)}),n(),i(26,"div",87),c(27),n()(),i(28,"div",84)(29,"label")(30,"i",22),c(31,"photo_camera"),n(),c(32),l(33,"translate"),i(34,"span",88),c(35),l(36,"translate"),n()(),i(37,"div",89),f("click",function(){_(e);let r=p();return g(r.triggerFileInput())})("dragover",function(r){_(e);let m=p();return g(m.onDragOver(r))})("dragleave",function(r){_(e);let m=p();return g(m.onDragLeave(r))})("drop",function(r){_(e);let m=p();return g(m.onDrop(r))}),i(38,"input",90),f("change",function(r){_(e);let m=p();return g(m.onFileChange(r))}),n(),b(39,we,7,4,"div",91)(40,Oe,9,6,"div",92),n()()(),i(41,"div",93)(42,"app-button",94),l(43,"translate"),f("click",function(){_(e);let r=p();return g(r.view="detail")}),n(),i(44,"app-button",95),l(45,"translate"),f("click",function(){_(e);let r=p();return g(r.submitReject())}),n()()()()}if(s&2){let e=p();a(6),h(" ",d(7,17,"BATCH.REJECT_BATCH")," "),a(7),v(d(14,19,"BATCH.REJECT_WARNING")),a(7),h(" ",d(21,21,"BATCH.REJECT_REASON"),": "),a(4),B("placeholder",d(25,23,"BATCH.ENTER_REASON_PLACEHOLDER")),y("ngModel",e.rejectReason),u("fullWidth",!0),a(3),h(" ",e.rejectReason.length||0,"/500 "),a(5),h(" ",d(33,25,"BATCH.EVIDENCE"),": "),a(3),v(d(36,27,"COMMON.OPTIONAL")),a(2),M("has-image",e.rejectImage),a(2),u("ngIf",e.rejectImage),a(),u("ngIf",!e.rejectImage),a(2),B("label",d(43,29,"COMMON.CANCEL")),a(2),B("label",d(45,31,"BATCH.CONFIRM_REJECT")),u("loading",e.isLoading)("disabled",!e.rejectReason||!e.rejectReason.trim())}}var oe=class s{constructor(t,e,o,r){this.batchService=t;this.authService=e;this.observationService=o;this.supplierService=r}view="table";batches=[];filteredBatches=[];selectedBatch=null;isCreatingObservation=!1;suppliers=[];currentUserId="";searchTerm="";showQuickFilters=!1;statusFilter=null;sortField="date";sortDirection="desc";isLoading=!1;notification={show:!1,message:"",type:"success"};rejectReason="";rejectImage="";selectedFile=null;createBatchObservation(t){if(this.isCreatingObservation)return;this.isCreatingObservation=!0;let e=new Date().toISOString(),o=new re({batchId:t.id,batchCode:t.code,businessmanId:this.currentUserId,supplierId:t.supplierId,reason:this.rejectReason,imageUrl:this.rejectImage||t.imageUrl,status:ne.PENDIENTE,createdAt:e});this.observationService.create(o).subscribe({next:()=>{console.log("Registro de observaci\xF3n creado correctamente"),this.isCreatingObservation=!1},error:r=>{console.error("Error al crear registro de observaci\xF3n:",r),this.isCreatingObservation=!1}})}ngOnInit(){let t=this.authService.getCurrentUser();t&&t.id&&(this.currentUserId=t.id,this.loadBatches(),this.loadSuppliers())}getSupplierCompanyName(t){return this.suppliers.find(o=>o.id===t)?.companyName||"Empresa no encontrada"}loadSuppliers(){this.supplierService.getAllSuppliers().subscribe({next:t=>{this.suppliers=t,console.log("Proveedores cargados:",t)},error:t=>{console.error("Error al cargar proveedores:",t)}})}loadBatches(){this.isLoading=!0,this.batchService.getAll().subscribe({next:t=>{console.log("Todos los lotes:",t),console.log("ID de usuario actual:",this.currentUserId),this.batches=t.filter(e=>{if(!e.businessmanId){let o=this.authService.getCurrentUser();return!!(o&&o.name&&e.client===o.name)}return e.businessmanId===this.currentUserId}),console.log("Lotes filtrados:",this.batches),this.filteredBatches=[...this.batches],this.filterBatches(),this.isLoading=!1},error:t=>{console.error("Error al cargar lotes:",t),this.showNotification("Error al cargar los lotes","error"),this.isLoading=!1}})}clearSearch(){this.searchTerm="",this.filterBatches()}toggleFilters(){this.showQuickFilters=!this.showQuickFilters}setStatusFilter(t){this.statusFilter=t,this.filterBatches()}filterBatches(){let t=[...this.batches];if(this.searchTerm&&this.searchTerm.trim()){let e=this.searchTerm.toLowerCase().trim();t=t.filter(o=>o.code&&o.code.toLowerCase().includes(e)||o.client&&o.client.toLowerCase().includes(e)||o.fabricType&&o.fabricType.toLowerCase().includes(e)||o.color&&o.color.toLowerCase().includes(e)||o.status&&o.status.toLowerCase().includes(e))}this.statusFilter&&(t=t.filter(e=>e.status===this.statusFilter)),t=this.sortBatches(t),this.filteredBatches=t}sortBy(t){this.sortField===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=t,this.sortDirection="asc"),this.filterBatches()}sortBatches(t){return t.sort((e,o)=>{let r,m;switch(this.sortField){case"code":r=e.code||"",m=o.code||"";break;case"client":r=e.client||"",m=o.client||"";break;case"date":r=new Date(e.date),m=new Date(o.date);break;case"price":r=e.price||0,m=o.price||0;break;default:return 0}return r<m?this.sortDirection==="asc"?-1:1:r>m?this.sortDirection==="asc"?1:-1:0})}trackByBatchId(t,e){return e.id||t.toString()}isUrgentBatch(t){if(t.status!==x.ACEPTADO)return!1;let e=new Date(t.date);return Math.floor((new Date().getTime()-e.getTime())/(1e3*60*60*24))>7}getStatusIcon(t){switch(t){case x.ACEPTADO:return"check_circle";case x.ENVIADO:return"local_shipping";case x.POR_ENVIAR:return"schedule";case x.RECHAZADO:return"cancel";case x.COMPLETADO:return"task_alt";default:return"help"}}viewBatchDetails(t){this.selectedBatch=t,this.view="detail"}backToTable(){this.view="table",this.selectedBatch=null}quickApprove(t){this.canApproveOrReject(t)&&confirm(`\xBFAprobar el lote ${t.code}?`)&&(this.selectedBatch=t,this.approveBatch())}quickReject(t){this.canApproveOrReject(t)&&(this.selectedBatch=t,this.showRejectForm())}approveBatch(){if(!this.selectedBatch)return;this.isLoading=!0;let t=S({},this.selectedBatch);t.status=x.COMPLETADO,this.batchService.update(this.selectedBatch.id,t).subscribe({next:()=>{this.showNotification("Lote aprobado correctamente","success"),this.loadBatches(),this.backToTable()},error:e=>{console.error("Error al aprobar lote:",e),this.showNotification("Error al aprobar el lote","error"),this.isLoading=!1}})}showRejectForm(){this.rejectReason="",this.rejectImage="",this.selectedFile=null,this.view="reject"}onFileChange(t){let e=t.target.files[0];e&&this.handleFileSelection(e)}handleFileSelection(t){t&&t.type.match(/image\/*/)&&t.size<5e6?(this.selectedFile=t,this.readAndCompressImage(t)):t.type.match(/image\/*/)?t.size>=5e6&&this.showNotification("La imagen debe ser menor a 5MB","warning"):this.showNotification("Por favor seleccione solo archivos de imagen","warning")}readAndCompressImage(t){let e=new FileReader;e.onload=o=>{let r=new Image;r.src=o.target.result,r.onload=()=>{let m=document.createElement("canvas"),j=m.getContext("2d"),E=800,T=600,w=r.width,O=r.height;w>O?w>E&&(O*=E/w,w=E):O>T&&(w*=T/O,O=T),m.width=w,m.height=O,j&&(j.drawImage(r,0,0,w,O),this.rejectImage=m.toDataURL("image/jpeg",.7))}},e.readAsDataURL(t)}onDragOver(t){t.preventDefault(),t.stopPropagation(),t.currentTarget.classList.add("drag-over")}onDragLeave(t){t.preventDefault(),t.stopPropagation(),t.currentTarget.classList.remove("drag-over")}onDrop(t){t.preventDefault(),t.stopPropagation(),t.currentTarget.classList.remove("drag-over");let o=t.dataTransfer?.files;if(o&&o.length>0){let r=o[0];this.handleFileSelection(r)}}removeImage(t){t.preventDefault(),t.stopPropagation(),this.rejectImage="",this.selectedFile=null}submitReject(){if(!this.selectedBatch)return;if(!this.rejectReason.trim()){this.showNotification("Por favor ingrese el motivo del rechazo","warning");return}this.isLoading=!0;let t=S({},this.selectedBatch);t.status=x.RECHAZADO,t.observations=this.rejectReason,t.imageUrl=this.rejectImage||this.selectedBatch.imageUrl,this.createBatchObservation(t),this.batchService.update(this.selectedBatch.id,t).subscribe({next:()=>{this.showNotification("Lote rechazado correctamente","success"),this.loadBatches(),this.backToTable()},error:e=>{console.error("Error al rechazar lote:",e),this.showNotification("Error al rechazar el lote","error"),this.isLoading=!1}})}openImageModal(t){window.open(t,"_blank")}showNotification(t,e){this.notification={show:!0,message:t,type:e}}getStatusClass(t){switch(t.toLowerCase()){case x.ACEPTADO.toLowerCase():return"status-approved";case x.ENVIADO.toLowerCase():return"status-sent";case x.POR_ENVIAR.toLowerCase():return"status-pending";case x.RECHAZADO.toLowerCase():return"status-rejected";case x.COMPLETADO.toLowerCase():return"status-completed";default:return""}}canApproveOrReject(t){return t.status===x.ACEPTADO}triggerFileInput(){document.getElementById("rejectImage")?.click()}static \u0275fac=function(e){return new(e||s)(P(te),P(X),P(ae),P(Z))};static \u0275cmp=H({type:s,selectors:[["app-businessman-batch"]],decls:5,vars:7,consts:[[1,"batch-container"],[4,"ngIf"],["class","detail-view",4,"ngIf"],["class","reject-form",4,"ngIf"],[3,"close","show","message","type","autoClose"],[1,"table-header"],[1,"header-left"],[1,"material-icons","header-icon"],["class","batch-count",4,"ngIf"],[1,"search-container"],[1,"search-input-wrapper"],[1,"material-icons","search-icon"],["type","text",1,"search-input",3,"ngModelChange","input","keyup.enter","placeholder","ngModel"],["class","clear-search",3,"click",4,"ngIf"],["variant","secondary","icon","tune",3,"click","label"],["variant","text","icon","refresh",3,"click","label","loading"],["class","quick-filters",4,"ngIf"],["class","loading-state",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","table-wrapper",4,"ngIf"],[1,"batch-count"],[1,"clear-search",3,"click"],[1,"material-icons"],[1,"quick-filters"],[1,"filter-chips"],[1,"filter-chip",3,"click"],[1,"status-dot","status-sent"],[1,"status-dot","status-approved"],[1,"loading-state"],[1,"skeleton-table"],["class","skeleton-row",4,"ngFor","ngForOf"],[1,"skeleton-row"],[1,"skeleton-cell"],[1,"empty-state"],[1,"empty-icon"],["variant","primary",3,"label","click",4,"ngIf"],["variant","primary",3,"click","label"],[1,"table-wrapper"],[1,"batch-table"],[1,"sortable",3,"click"],[1,"th-content"],[1,"material-icons","sort-icon"],[1,"text-right"],[1,"actions-column"],["class","clickable-row",3,"urgent","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"clickable-row",3,"click"],[1,"code-cell"],[1,"batch-code"],[1,"material-icons","batch-icon"],[1,"supplier-info"],[1,"supplier-name"],[1,"fabric-type"],[1,"date-text"],[1,"status-container"],[1,"status-badge",3,"ngClass"],[1,"material-icons","status-icon"],[1,"price-text"],[1,"actions-cell",3,"click"],[1,"action-buttons"],["class","action-btn approve-btn",3,"title","click",4,"ngIf"],["class","action-btn reject-btn",3,"title","click",4,"ngIf"],[1,"action-btn","view-btn",3,"click","title"],[1,"action-btn","approve-btn",3,"click","title"],[1,"action-btn","reject-btn",3,"click","title"],[1,"detail-view"],[1,"detail-header"],["label","","icon","arrow_back","variant","back",3,"click"],[1,"material-icons","detail-icon"],[1,"detail-content"],[1,"detail-grid"],[1,"detail-item"],[1,"detail-value"],["class","batch-image-container",4,"ngIf"],["class","action-buttons",4,"ngIf"],[1,"batch-image-container"],[1,"image-header"],[1,"batch-image",3,"click","src","alt"],["variant","primary","icon","check_circle",3,"click","label","loading"],["variant","secondary","icon","cancel",3,"click","label"],[1,"reject-form"],[1,"material-icons","reject-icon"],[1,"reject-content"],[1,"reject-warning"],[1,"form-section"],[1,"form-group"],[1,"required"],["type","textarea",3,"ngModelChange","ngModel","placeholder","fullWidth"],[1,"char-counter"],[1,"optional"],[1,"upload-area",3,"click","dragover","dragleave","drop"],["type","file","id","rejectImage","accept","image/*",2,"display","none",3,"change"],["class","image-preview",4,"ngIf"],["class","upload-placeholder",4,"ngIf"],[1,"form-actions"],["variant","text",3,"click","label"],["variant","primary","icon","send",3,"click","label","loading","disabled"],[1,"image-preview"],[1,"preview-image",3,"src","alt"],[1,"image-actions"],[1,"remove-image",3,"click"],[1,"upload-placeholder"],[1,"material-icons","upload-icon"],[1,"upload-text"],[1,"upload-subtext"]],template:function(e,o){e&1&&(i(0,"div",0),b(1,xe,24,20,"div",1)(2,Be,78,44,"div",2)(3,Me,46,33,"div",3),i(4,"app-notification",4),f("close",function(){return o.notification.show=!1}),n()()),e&2&&(a(),u("ngIf",o.view==="table"),a(),u("ngIf",o.view==="detail"&&o.selectedBatch),a(),u("ngIf",o.view==="reject"&&o.selectedBatch),a(),u("show",o.notification.show)("message",o.notification.message)("type",o.notification.type)("autoClose",!0))},dependencies:[q,F,N,z,U,K,Y,Q,J,ee,$,ie,G,W],styles:[".batch-container[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto;padding:1.5rem;min-height:100vh}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;padding:1.5rem;background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000000a;border:1px solid #f0f0f0}.header-left[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin:0;color:#2c3e50;font-size:1.5rem;font-weight:600}.header-icon[_ngcontent-%COMP%]{color:#a68b6b!important;font-size:1.75rem!important}.batch-count[_ngcontent-%COMP%]{background:#a68b6b;color:#fff;padding:.25rem .75rem;border-radius:16px;font-size:.875rem;font-weight:500;margin-left:.5rem}.search-container[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:center}.search-input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;background:#f8f9fa;border:2px solid #e9ecef;border-radius:10px;padding:.75rem 1rem;width:320px;transition:all .2s ease}.search-input-wrapper[_ngcontent-%COMP%]:hover{border-color:#a68b6b;background:#fff}.search-input-wrapper[_ngcontent-%COMP%]:focus-within{border-color:#a68b6b;background:#fff;box-shadow:0 0 0 3px #a68b6b1a}.search-input[_ngcontent-%COMP%]{border:none;outline:none;background:transparent;flex:1;font-size:1rem;color:#495057;margin-left:.5rem;margin-right:.5rem}.search-input[_ngcontent-%COMP%]::placeholder{color:#6c757d}.search-icon[_ngcontent-%COMP%]{color:#6c757d!important;font-size:1.25rem!important;flex-shrink:0}.search-input-wrapper[_ngcontent-%COMP%]:focus-within   .search-icon[_ngcontent-%COMP%]{color:#a68b6b!important}.clear-search[_ngcontent-%COMP%]{background:none;border:none;padding:.25rem;border-radius:4px;cursor:pointer;margin-left:.5rem;color:#6c757d;transition:all .2s ease}.clear-search[_ngcontent-%COMP%]:hover{background:#f8f9fa;color:#495057}.quick-filters[_ngcontent-%COMP%]{margin-bottom:1.5rem;padding:1rem 1.5rem;background:#fff;border-radius:12px;border:1px solid #f0f0f0}.filter-chips[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-wrap:wrap}.filter-chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:#f8f9fa;border:1px solid #e9ecef;border-radius:20px;font-size:.875rem;cursor:pointer;transition:all .2s ease;color:#495057}.filter-chip[_ngcontent-%COMP%]:hover{background:#e9ecef;border-color:#a68b6b}.filter-chip.active[_ngcontent-%COMP%]{background:#a68b6b;color:#fff;border-color:#a68b6b}.filter-chip[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1rem!important;width:1rem!important;height:1rem!important}.loading-state[_ngcontent-%COMP%]{padding:2rem}.skeleton-table[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.skeleton-row[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:1rem;background:#fff;border-radius:8px;border:1px solid #f0f0f0}.skeleton-cell[_ngcontent-%COMP%]{height:20px;background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0,#f0f0f0 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_loading 1.5s infinite;border-radius:4px;flex:1}@keyframes _ngcontent-%COMP%_loading{0%{background-position:200% 0}to{background-position:-200% 0}}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;background:#fff;border-radius:12px;border:2px dashed #e9ecef}.empty-icon[_ngcontent-%COMP%]{margin-bottom:1.5rem}.empty-icon[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:4rem!important;width:4rem!important;height:4rem!important;color:#dee2e6}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#495057;margin-bottom:.5rem;font-weight:600}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6c757d;margin-bottom:2rem}.table-wrapper[_ngcontent-%COMP%]{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px #0000000a;border:1px solid #f0f0f0}.batch-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.batch-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8f9fa;padding:1rem;text-align:left;font-weight:600;color:#495057;border-bottom:2px solid #e9ecef;white-space:nowrap}.batch-table[_ngcontent-%COMP%]   th.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;transition:background-color .2s ease}.batch-table[_ngcontent-%COMP%]   th.sortable[_ngcontent-%COMP%]:hover{background:#e9ecef}.th-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.sort-icon[_ngcontent-%COMP%]{font-size:1rem!important;color:#adb5bd!important;opacity:0;transition:opacity .2s ease}.batch-table[_ngcontent-%COMP%]   th.sortable[_ngcontent-%COMP%]:hover   .sort-icon[_ngcontent-%COMP%]{opacity:1}.batch-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #f8f9fa;vertical-align:middle}.clickable-row[_ngcontent-%COMP%]{cursor:pointer;transition:all .2s ease;position:relative}.clickable-row[_ngcontent-%COMP%]:hover{background:#f8f9fa;transform:translateY(-1px);box-shadow:0 4px 12px #00000014}.clickable-row.urgent[_ngcontent-%COMP%]{border-left:4px solid #ff6b6b}.code-cell[_ngcontent-%COMP%]{min-width:150px}.batch-code[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:600;color:#2c3e50}.batch-icon[_ngcontent-%COMP%]{color:#a68b6b!important;font-size:1.25rem!important}.supplier-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.supplier-name[_ngcontent-%COMP%]{font-weight:500;color:#2c3e50}.fabric-type[_ngcontent-%COMP%]{color:#495057;background:#f8f9fa;padding:.25rem .75rem;border-radius:16px;font-size:.875rem;display:inline-block}.date-text[_ngcontent-%COMP%]{color:#6c757d;font-variant-numeric:tabular-nums}.price-text[_ngcontent-%COMP%]{font-weight:600;color:#28a745;font-variant-numeric:tabular-nums}.text-right[_ngcontent-%COMP%]{text-align:right}.status-container[_ngcontent-%COMP%]{display:flex;align-items:center}.status-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;border-radius:20px;font-size:.875rem;font-weight:500;text-transform:uppercase;letter-spacing:.025em;transition:all .2s ease}.status-badge.large[_ngcontent-%COMP%]{padding:.75rem 1.25rem;font-size:.9rem}.status-icon[_ngcontent-%COMP%]{font-size:1rem!important;width:1rem!important;height:1rem!important}.status-approved[_ngcontent-%COMP%]{background:#d4edda;color:#155724;border:1px solid #c3e6cb}.status-sent[_ngcontent-%COMP%]{background:#cce7ff;color:#004085;border:1px solid #99d3ff}.status-pending[_ngcontent-%COMP%]{background:#fff3cd;color:#856404;border:1px solid #ffeaa7}.status-rejected[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.status-completed[_ngcontent-%COMP%]{background:#e2e3ff;color:#383d9a;border:1px solid #c5c6ff}.actions-column[_ngcontent-%COMP%]{width:140px;text-align:center}.actions-cell[_ngcontent-%COMP%]{padding:.5rem!important}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.25rem;justify-content:center;opacity:0;transition:opacity .2s ease}.clickable-row[_ngcontent-%COMP%]:hover   .action-buttons[_ngcontent-%COMP%]{opacity:1}.action-btn[_ngcontent-%COMP%]{width:32px;height:32px;border:none;border-radius:6px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease;background:#fff;border:1px solid #e9ecef}.action-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1rem!important;width:1rem!important;height:1rem!important}.approve-btn[_ngcontent-%COMP%]{color:#28a745;border-color:#28a745}.approve-btn[_ngcontent-%COMP%]:hover{background:#28a745;color:#fff;transform:scale(1.1)}.reject-btn[_ngcontent-%COMP%]{color:#dc3545;border-color:#dc3545}.reject-btn[_ngcontent-%COMP%]:hover{background:#dc3545;color:#fff;transform:scale(1.1)}.view-btn[_ngcontent-%COMP%]{color:#007bff;border-color:#007bff}.view-btn[_ngcontent-%COMP%]:hover{background:#007bff;color:#fff;transform:scale(1.1)}.detail-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:2rem;background:linear-gradient(135deg,#f8f9fa,#fff);border-bottom:1px solid #e9ecef}.header-info[_ngcontent-%COMP%]{flex:1;margin-left:1rem}.header-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin:0 0 .5rem;color:#2c3e50;font-size:1.5rem;font-weight:600}.header-subtitle[_ngcontent-%COMP%]{color:#6c757d;font-size:1rem;font-weight:500}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center}.detail-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem;margin-bottom:2rem}.detail-card[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #e9ecef;border-radius:12px;overflow:hidden;transition:all .2s ease}.detail-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 16px #0000001a}.detail-view[_ngcontent-%COMP%]{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 16px #00000014;border:1px solid #f0f0f0}.detail-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:2rem;background:linear-gradient(135deg,#f8f9fa,#fff);border-bottom:1px solid #e9ecef}.detail-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin:0 0 0 1rem;color:#2c3e50;font-size:1.5rem;font-weight:600}.detail-icon[_ngcontent-%COMP%]{color:#a68b6b!important;font-size:1.75rem!important}.detail-content[_ngcontent-%COMP%]{padding:2rem}.detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1.5rem;margin-bottom:2rem}.detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.detail-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:600;color:#666;margin-bottom:.5rem}.detail-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1.25rem!important;color:#a68b6b!important}.detail-value[_ngcontent-%COMP%]{font-size:1.1rem;color:#2c3e50;font-weight:500}.batch-image-container[_ngcontent-%COMP%]{width:100%;margin:1.5rem 0;text-align:center}.image-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:1rem;padding:1rem;background:#f8f9fa;border-radius:8px}.image-header[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:#a68b6b!important;font-size:1.25rem!important}.image-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#2c3e50;font-weight:600}.batch-image[_ngcontent-%COMP%]{max-width:100%;max-height:400px;border-radius:8px;box-shadow:0 1px 5px #0000001a;cursor:pointer;transition:all .2s ease}.batch-image[_ngcontent-%COMP%]:hover{transform:scale(1.02);box-shadow:0 8px 25px #00000026}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;margin-top:2rem}.reject-form[_ngcontent-%COMP%]{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 16px #00000014;border:1px solid #f0f0f0}.reject-icon[_ngcontent-%COMP%]{color:#dc3545!important;font-size:1.75rem!important}.reject-content[_ngcontent-%COMP%]{padding:2rem;max-width:800px;margin:0 auto}.reject-warning[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem 1.5rem;background:#fff3cd;border:1px solid #ffeaa7;border-radius:8px;margin-bottom:2rem}.reject-warning[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:#856404!important;font-size:1.5rem!important}.reject-warning[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#856404;font-weight:500}.form-section[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]{margin-bottom:2rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:600;margin-bottom:.75rem;color:#2c3e50}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1.25rem!important;color:#a68b6b!important}.required[_ngcontent-%COMP%]{color:#dc3545;font-weight:700}.optional[_ngcontent-%COMP%]{color:#6c757d;font-weight:400;font-size:.875rem;margin-left:.5rem}.char-counter[_ngcontent-%COMP%]{text-align:right;font-size:.875rem;color:#6c757d;margin-top:.5rem}.upload-area[_ngcontent-%COMP%]{border:2px dashed #dee2e6;border-radius:12px;padding:2rem;text-align:center;cursor:pointer;transition:all .2s ease;background:#f8f9fa;position:relative}.upload-area[_ngcontent-%COMP%]:hover{border-color:#a68b6b;background:#fff;transform:translateY(-2px)}.upload-area.has-image[_ngcontent-%COMP%]{padding:1rem;background:#fff;border-color:#a68b6b}.image-preview[_ngcontent-%COMP%]{position:relative;display:inline-block}.preview-image[_ngcontent-%COMP%]{max-width:100%;max-height:300px;border-radius:8px;display:block}.image-actions[_ngcontent-%COMP%]{position:absolute;top:.5rem;right:.5rem}.remove-image[_ngcontent-%COMP%]{width:32px;height:32px;background:#dc3545e6;color:#fff;border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.remove-image[_ngcontent-%COMP%]:hover{background:#dc3545;transform:scale(1.1)}.upload-placeholder[_ngcontent-%COMP%]{padding:2rem}.upload-icon[_ngcontent-%COMP%]{font-size:3rem!important;width:3rem!important;height:3rem!important;color:#a68b6b!important;margin-bottom:1rem}.upload-text[_ngcontent-%COMP%]{font-weight:600;color:#495057;margin:0 0 .5rem}.upload-subtext[_ngcontent-%COMP%]{color:#6c757d;font-size:.875rem;margin:0}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;padding-top:2rem;border-top:1px solid #e9ecef}@media (max-width: 768px){.batch-container[_ngcontent-%COMP%]{padding:1rem}.table-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:1rem}.search-container[_ngcontent-%COMP%]{width:100%;flex-direction:column}.search-input-wrapper[_ngcontent-%COMP%]{width:100%}.detail-cards[_ngcontent-%COMP%], .detail-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.action-buttons[_ngcontent-%COMP%], .form-actions[_ngcontent-%COMP%]{flex-direction:column}.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}.batch-table[_ngcontent-%COMP%]{min-width:700px}.batch-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(3), .batch-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(3){display:none}}@media (max-width: 480px){.header-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem}.detail-content[_ngcontent-%COMP%], .card-header[_ngcontent-%COMP%], .detail-grid[_ngcontent-%COMP%], .reject-content[_ngcontent-%COMP%]{padding:1rem}.upload-area[_ngcontent-%COMP%]{padding:1.5rem}}"]})};export{oe as BusinessmanBatchComponent};
