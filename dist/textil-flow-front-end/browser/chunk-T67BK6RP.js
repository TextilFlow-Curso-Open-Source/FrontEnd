import{a as D}from"./chunk-JEEPOO6Z.js";import{a as U,b as R}from"./chunk-7HCVPO4N.js";import{a as k}from"./chunk-MN7AUO3D.js";import{a as G}from"./chunk-7L5BX6GK.js";import{S as V,q as B}from"./chunk-WV37CKRB.js";import"./chunk-UTGZS7YI.js";import{b as F}from"./chunk-YNTG2JIL.js";import{d as M,e as y,l as N,t as P,v as A}from"./chunk-27FP4Y7A.js";import{C as E,x as L,z as T}from"./chunk-XE5R4NI6.js";import"./chunk-ONYPU5BJ.js";import"./chunk-XMN5GRMF.js";import{$a as n,Ab as I,Bb as O,Hb as r,Ib as o,Jb as w,Nb as C,Rb as v,Sb as g,bc as u,cc as h,dc as b,e as S,eb as m,la as f,lb as x,ma as d,nc as s,oc as c,qb as _,yb as l}from"./chunk-ZUXVFBKG.js";function $(a,e){a&1&&(r(0,"div",4),u(1),s(2,"translate"),o()),a&2&&(n(),b(" ",c(2,1,"COMMON.LOADING")," "))}function j(a,e){if(a&1){let i=C();r(0,"div",15)(1,"button",16),v("click",function(){let p=f(i).$implicit,W=g(2);return d(W.changeLanguage(p.value))}),u(2),o()()}if(a&2){let i=e.$implicit,t=g(2);n(),I("active",t.configuration.language===i.value),n(),b(" ",i.label," ")}}function Q(a,e){if(a&1){let i=C();r(0,"div")(1,"h2"),u(2),s(3,"translate"),o(),r(4,"div",5)(5,"label"),u(6),s(7,"translate"),o(),r(8,"div",6),_(9,j,3,3,"div",7),o()(),r(10,"div",5)(11,"label"),u(12),s(13,"translate"),o(),w(14,"app-theme-switcher",8),o(),r(15,"div",5)(16,"label"),u(17),s(18,"translate"),o(),r(19,"div",9)(20,"span",10),u(21),s(22,"translate"),o(),r(23,"button",11),u(24),s(25,"translate"),o()()(),r(26,"div",12)(27,"app-button",13),s(28,"translate"),v("click",function(){f(i);let p=g();return d(p.saveConfiguration())}),o(),r(29,"app-button",14),s(30,"translate"),v("click",function(){f(i);let p=g();return d(p.cancel())}),o()()()}if(a&2){let i=g();n(2),h(c(3,15,"CONFIGURATION.TITLE")),n(4),h(c(7,17,"CONFIGURATION.LANGUAGE")),n(3),l("ngForOf",i.languageOptions),n(3),h(c(13,19,"CONFIGURATION.VIEW_MODE")),n(2),l("showLabels",!0)("fullWidth",!0),n(3),h(c(18,21,"CONFIGURATION.SUBSCRIPTION")),n(3),O("plan-"+i.configuration.subscriptionPlan),n(),b(" ",c(22,23,"PLANS."+((i.configuration.subscriptionPlan==null?null:i.configuration.subscriptionPlan.toUpperCase())||"BASIC"))," "),n(3),b(" ",c(25,25,"CONFIGURATION.MANAGE_PLAN")," "),n(3),l("label",c(28,27,"COMMON.SAVE"))("loading",i.isLoading),n(2),l("label",c(30,29,"COMMON.CANCEL"))("disabled",i.isLoading)}}function q(a,e){if(a&1){let i=C();r(0,"app-notification",17),v("close",function(){f(i);let p=g();return d(p.notification.show=!1)}),o()}if(a&2){let i=g();l("message",i.notification.message)("type",i.notification.type)}}var z=class a{constructor(e,i,t,p){this.configurationService=e;this.authService=i;this.themeService=t;this.translateService=p;this.translateService.addLangs(["es","en"]),this.translateService.setDefaultLang("es"),this.translateService.use("es")}currentUserId="";configuration=null;languageOptions=[{label:"Espa\xF1ol",value:"es"},{label:"English",value:"en"}];subscriptionOptions=[{label:"B\xE1sico",value:"basic"},{label:"Corporativo",value:"corporate"}];isLoading=!1;notification={show:!1,message:"",type:"success"};subscriptions=new S;ngOnInit(){let e=this.authService.getCurrentUser();e&&e.id&&(this.currentUserId=e.id,this.loadConfiguration()),this.subscriptions.add(this.themeService.theme$.subscribe(t=>{this.configuration&&this.configuration.viewMode!==t&&!this.isLoading&&(console.log(`\u{1F3A8} Tema cambiado externamente: ${this.configuration.viewMode} \u2192 ${t}`),this.configuration.viewMode=t,this.savePreferencesQuietly())}));let i=localStorage.getItem("userLanguage");i&&this.translateService.getLangs().includes(i)&&this.translateService.use(i)}ngOnDestroy(){this.subscriptions.unsubscribe()}changeLanguage(e){this.translateService.use(e),localStorage.setItem("userLanguage",e),this.configuration&&(this.configuration.language=e,this.savePreferencesOnly())}loadConfiguration(){this.isLoading=!0;let e=parseInt(this.currentUserId,10);this.configurationService.getConfigurationByUserId(e).subscribe({next:i=>{this.configuration=i,this.configuration.userType="businessman",this.applyConfigurationSettings(),this.isLoading=!1},error:i=>{console.error("Error al cargar configuraci\xF3n:",i),this.showNotification(this.translateService.instant("CONFIGURATION.ERROR_LOAD"),"error"),this.isLoading=!1,this.configuration=new U({userId:this.currentUserId,userType:"businessman",language:"es",viewMode:"auto",subscriptionPlan:"basic"})}})}applyConfigurationSettings(){this.configuration&&(this.configuration.language&&this.changeLanguageWithoutSave(this.configuration.language),this.configuration.viewMode&&this.themeService.syncFromConfiguration(this.configuration.viewMode))}changeLanguageWithoutSave(e){this.translateService.use(e),localStorage.setItem("userLanguage",e)}saveConfiguration(){if(this.configuration)if(this.isLoading=!0,this.configuration.viewMode&&this.themeService.setTheme(this.configuration.viewMode),this.configuration.id){let e=parseInt(this.configuration.id,10);console.log("\u{1F4BE} Guardando configuraci\xF3n:",{language:this.configuration.language,viewMode:this.configuration.viewMode,subscriptionPlan:this.configuration.subscriptionPlan}),this.configurationService.updateMultiplePreferences(e,{language:this.configuration.language,viewMode:this.configuration.viewMode,subscriptionPlan:this.configuration.subscriptionPlan}).subscribe({next:i=>{console.log("\u2705 Configuraci\xF3n guardada exitosamente:",i),this.configuration=i,this.configuration.userType="businessman",i.viewMode&&this.themeService.setTheme(i.viewMode),this.showNotification(this.translateService.instant("CONFIGURATION.SUCCESS_SAVE"),"success"),this.isLoading=!1},error:i=>{console.error("Error al guardar configuraci\xF3n:",i),this.showNotification(this.translateService.instant("CONFIGURATION.ERROR_SAVE"),"error"),this.isLoading=!1}})}else console.warn("\u26A0\uFE0F Configuraci\xF3n sin ID - el backend deber\xEDa crearla autom\xE1ticamente"),this.showNotification("Error: Configuraci\xF3n no encontrada","error"),this.isLoading=!1}savePreferencesQuietly(){if(!this.configuration||this.isLoading||!this.configuration.id)return;let e=parseInt(this.configuration.id,10);this.configurationService.updateUserPreferences(e,this.configuration.language,this.configuration.viewMode).subscribe({next:i=>{this.configuration.userType="businessman",this.configuration.subscriptionPlan=i.subscriptionPlan,this.configuration.updatedAt=i.updatedAt},error:i=>{console.error("Error al actualizar preferencias:",i)}})}savePreferencesOnly(){if(!this.configuration||this.isLoading)return;this.isLoading=!0;let e=parseInt(this.configuration.id,10);this.configurationService.updateUserPreferences(e,this.configuration.language,this.configuration.viewMode).subscribe({next:i=>{this.configuration=i,this.configuration.userType="businessman",this.showNotification(this.translateService.instant("CONFIGURATION.SUCCESS_SAVE"),"success"),this.isLoading=!1},error:i=>{console.error("Error al actualizar preferencias:",i),this.showNotification(this.translateService.instant("CONFIGURATION.ERROR_SAVE"),"error"),this.isLoading=!1}})}cancel(){this.loadConfiguration()}showNotification(e,i){this.notification={show:!0,message:e,type:i},setTimeout(()=>{this.notification.show=!1},3e3)}static \u0275fac=function(i){return new(i||a)(m(R),m(F),m(k),m(L))};static \u0275cmp=x({type:a,selectors:[["app-businessman-configuration"]],decls:4,vars:3,consts:[[1,"configuration-container"],["class","loading-indicator",4,"ngIf"],[4,"ngIf"],[3,"message","type","close",4,"ngIf"],[1,"loading-indicator"],[1,"form-group"],[1,"language-options"],["class","language-option",4,"ngFor","ngForOf"],["variant","buttons","size","medium",3,"showLabels","fullWidth"],[1,"subscription-info"],[1,"plan-badge"],["routerLink","/businessman/planes",1,"manage-plan-btn"],[1,"button-container"],["variant","primary",3,"click","label","loading"],["variant","secondary",3,"click","label","disabled"],[1,"language-option"],[1,"language-button",3,"click"],[3,"close","message","type"]],template:function(i,t){i&1&&(r(0,"div",0),_(1,$,3,3,"div",1)(2,Q,31,31,"div",2)(3,q,1,2,"app-notification",3),o()),i&2&&(n(),l("ngIf",t.isLoading),n(),l("ngIf",!t.isLoading&&t.configuration),n(),l("ngIf",t.notification.show))},dependencies:[N,M,y,B,V,G,D,E,T,A,P],styles:[".configuration-container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:500}.language-options[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:10px}.language-button[_ngcontent-%COMP%]{padding:8px 16px;background-color:#f5f5f5;border:1px solid #ddd;border-radius:4px;cursor:pointer;transition:all .3s}.language-button.active[_ngcontent-%COMP%]{background-color:#963;color:#fff;border-color:#963}.button-container[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:20px}.loading-indicator[_ngcontent-%COMP%]{text-align:center;padding:20px}.subscription-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.plan-badge[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;font-size:.85rem;font-weight:500}.plan-basic[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151}.plan-corporate[_ngcontent-%COMP%]{background:#963;color:#fff}.manage-plan-btn[_ngcontent-%COMP%]{padding:6px 12px;background:transparent;color:var(--primary-color);border:1px solid var(--primary-color);border-radius:6px;font-size:.85rem;cursor:pointer;transition:all .2s}.manage-plan-btn[_ngcontent-%COMP%]:hover{background:var(--primary-color);color:#fff}"]})};export{z as BusinessmanConfigurationComponent};
