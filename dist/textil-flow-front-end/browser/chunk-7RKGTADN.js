import{a as y,b as E}from"./chunk-7E74X2WU.js";import{C as T,z as P}from"./chunk-S4BAPOHJ.js";import{d as M,e as D,k as N,r as w,w as H}from"./chunk-Z3ABZYYA.js";import"./chunk-GNQ3TXIC.js";import{$b as i,Fb as n,Gb as t,Lb as B,Pb as g,Qb as b,_a as e,ac as d,bc as h,cc as S,da as C,kb as I,la as v,lc as r,ma as O,mc as s,pb as A,wb as x}from"./chunk-LJ6G2VOH.js";function U(p,m){if(p&1){let o=B();n(0,"button",8),g("click",function(){v(o);let c=b();return O(c.openNotifications())}),i(1),r(2,"translate"),t()}p&2&&(e(),h(" ",s(2,1,"BUSINESSMANDASHBOARD.SHOW_NOTIFICATIONS")," "))}function V(p,m){if(p&1&&(n(0,"li"),i(1),t()),p&2){let o=m.$implicit;e(),d(o)}}function z(p,m){if(p&1&&(n(0,"li")(1,"div",17)(2,"strong"),i(3),r(4,"translate"),t(),n(5,"ul"),A(6,V,2,1,"li",15),t()()()),p&2){let o=m.$implicit;e(3),S("",s(4,3,"BUSINESSMANDASHBOARD.BATCH_CODE")," ",o.code,":"),e(3),x("ngForOf",o.messages)}}function F(p,m){if(p&1){let o=B();n(0,"div",9)(1,"div",10)(2,"div",11)(3,"span",12),i(4,"\u24D8"),t(),n(5,"h3"),i(6),r(7,"translate"),t()(),n(8,"button",13),g("click",function(){v(o);let c=b();return O(c.closeNotifications())}),i(9,"\u2715"),t()(),n(10,"ul",14),A(11,z,7,5,"li",15),t(),n(12,"button",16),g("click",function(){v(o);let c=b();return O(c.viewMoreNotifications())}),i(13),r(14,"translate"),t()()}if(p&2){let o=b();e(6),d(s(7,3,"BUSINESSMANDASHBOARD.RECENT_NOTIFICATIONS")),e(5),x("ngForOf",o.notificationsGrouped),e(2),h(" ",s(14,5,"BUSINESSMANDASHBOARD.VIEW_ALL_NOTIFICATIONS")," ")}}var k=class p{batchService=C(y);authService=C(H);router=C(w);businessmanName="Empresario";lotSummary={receivedToday:0,pending:0,approved:0,rejected:0};notificationsGrouped=[];showNotifications=!0;ngOnInit(){let m=this.authService.getCurrentUser();if(m){let o=m.name??"",a=m.email??"";o.trim()?this.businessmanName=o.trim():a.includes("@")&&(this.businessmanName=a.split("@")[0]||"Empresario")}this.batchService.getAll().subscribe(o=>{let a=new Date;a.setHours(0,0,0,0);let c={receivedToday:0,pending:0,approved:0,rejected:0},_={},R=[...o].sort((l,u)=>new Date(u.date).getTime()-new Date(l.date).getTime());for(let l of R){let u=new Date(l.date);if(u.setHours(0,0,0,0),u.getTime()===a.getTime()&&c.receivedToday++,l.status===E.PENDIENTE){c.pending++;let f=l.code??"Sin c\xF3digo";_[f]||(_[f]=[]),(new Date().getTime()-u.getTime())/(1e3*3600*24)>2&&_[f].push(`El lote ${f} lleva m\xE1s de 2 d\xEDas pendiente de revisi\xF3n.`),l.observations&&l.observations.trim()!==""&&_[f].push(`Hay observaciones en el lote ${f}.`),(l.imageUrl??"").trim()||_[f].push(`Falta evidencia en el lote ${f}.`)}else l.status===E.ACEPTADO?c.approved++:l.status===E.RECHAZADO&&c.rejected++}this.lotSummary=c,this.notificationsGrouped=Object.entries(_).map(([l,u])=>({code:l,messages:u}))})}viewDetails(m){this.router.navigate(["/businessman/lotes"])}viewMoreNotifications(){this.router.navigate(["/businessman/lotes"])}closeNotifications(){this.showNotifications=!1}openNotifications(){this.showNotifications=!0}static \u0275fac=function(o){return new(o||p)};static \u0275cmp=I({type:p,selectors:[["app-businessman-home"]],decls:51,vars:49,consts:[[1,"dashboard-container"],[1,"welcome-section"],[1,"stats-container"],[1,"stat-card"],[1,"stat-number"],[1,"btn-details",3,"click"],["class","btn-show-notifications",3,"click",4,"ngIf"],["class","notifications-container",4,"ngIf"],[1,"btn-show-notifications",3,"click"],[1,"notifications-container"],[1,"notifications-header"],[1,"notifications-title"],[1,"notification-icon"],[1,"close-btn",3,"click"],[1,"notifications-list"],[4,"ngFor","ngForOf"],[1,"btn-more-details",3,"click"],[1,"notification-item"]],template:function(o,a){o&1&&(n(0,"div",0)(1,"div",1)(2,"h1"),i(3),r(4,"translate"),t(),n(5,"p"),i(6),r(7,"translate"),t()(),n(8,"div",2)(9,"div",3)(10,"h2"),i(11),r(12,"translate"),t(),n(13,"p",4),i(14),r(15,"translate"),t(),n(16,"button",5),g("click",function(){return a.viewDetails("recibidos")}),i(17),r(18,"translate"),t()(),n(19,"div",3)(20,"h2"),i(21),r(22,"translate"),t(),n(23,"p",4),i(24),r(25,"translate"),t(),n(26,"button",5),g("click",function(){return a.viewDetails("pendientes")}),i(27),r(28,"translate"),t()(),n(29,"div",3)(30,"h2"),i(31),r(32,"translate"),t(),n(33,"p",4),i(34),r(35,"translate"),t(),n(36,"button",5),g("click",function(){return a.viewDetails("aprobados")}),i(37),r(38,"translate"),t()(),n(39,"div",3)(40,"h2"),i(41),r(42,"translate"),t(),n(43,"p",4),i(44),r(45,"translate"),t(),n(46,"button",5),g("click",function(){return a.viewDetails("rechazados")}),i(47),r(48,"translate"),t()()(),A(49,U,3,3,"button",6)(50,F,15,7,"div",7),t()),o&2&&(e(3),S("",s(4,21,"BUSINESSMANDASHBOARD.WELCOME"),", ",a.businessmanName,""),e(3),d(s(7,23,"BUSINESSMANDASHBOARD.DASHBOARD_DESCRIPTION")),e(5),d(s(12,25,"BUSINESSMANDASHBOARD.RECEIVED_TODAY")),e(3),S("",a.lotSummary.receivedToday," ",s(15,27,"BUSINESSMANDASHBOARD.BATCHES"),""),e(3),d(s(18,29,"BUSINESSMANDASHBOARD.VIEW_DETAILS")),e(4),d(s(22,31,"BUSINESSMANDASHBOARD.PENDING_REVIEW")),e(3),S("",a.lotSummary.pending," ",s(25,33,"BUSINESSMANDASHBOARD.BATCHES"),""),e(3),d(s(28,35,"BUSINESSMANDASHBOARD.VIEW_DETAILS")),e(4),d(s(32,37,"BUSINESSMANDASHBOARD.APPROVED_BATCHES")),e(3),S("",a.lotSummary.approved," ",s(35,39,"BUSINESSMANDASHBOARD.BATCHES"),""),e(3),d(s(38,41,"BUSINESSMANDASHBOARD.VIEW_DETAILS")),e(4),d(s(42,43,"BUSINESSMANDASHBOARD.REJECTED_BATCHES")),e(3),S("",a.lotSummary.rejected," ",s(45,45,"BUSINESSMANDASHBOARD.BATCHES"),""),e(3),d(s(48,47,"BUSINESSMANDASHBOARD.VIEW_DETAILS")),e(2),x("ngIf",!a.showNotifications),e(),x("ngIf",a.showNotifications))},dependencies:[N,M,D,T,P],styles:[".dashboard-container[_ngcontent-%COMP%]{padding:20px;max-width:1000px;margin:0 auto;font-family:Arial,sans-serif}.welcome-section[_ngcontent-%COMP%]{margin-bottom:30px}.welcome-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px;margin-bottom:8px;color:#333}.welcome-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#555;font-size:16px}.stats-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(2,1fr);gap:20px;margin-bottom:30px;max-width:800px;margin-left:auto;margin-right:auto}.stat-card[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ddd;padding:20px;border-radius:4px;text-align:center;min-height:140px;display:flex;flex-direction:column;justify-content:center}.stat-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;color:#555;margin-bottom:10px}.stat-number[_ngcontent-%COMP%]{font-size:20px;font-weight:700;margin-bottom:15px;color:#333}.btn-details[_ngcontent-%COMP%]{background-color:#8a7155;color:#fff;border:none;padding:8px 15px;border-radius:4px;cursor:pointer;font-size:14px}.btn-details[_ngcontent-%COMP%]:hover{background-color:#6e5a43}.notifications-container[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ddd;border-radius:4px;padding:15px;max-width:800px;margin:0 auto}.notifications-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.notifications-title[_ngcontent-%COMP%]{display:flex;align-items:center}.notification-icon[_ngcontent-%COMP%]{margin-right:10px;font-size:18px;color:#555}.notifications-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:16px;color:#333;margin:0}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:16px;color:#777;cursor:pointer}.notifications-list[_ngcontent-%COMP%]{list-style-type:disc;padding-left:20px;margin-bottom:15px}.notifications-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:10px;color:#555}.notification-item[_ngcontent-%COMP%]{margin-bottom:15px}.notification-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333;display:block;margin-bottom:5px}.notification-item[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:15px}.notification-item[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:5px;font-size:14px}.btn-more-details[_ngcontent-%COMP%]{background-color:#8a7155;color:#fff;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:14px;display:block;width:140px;text-align:center;margin:0 auto}.btn-more-details[_ngcontent-%COMP%]:hover{background-color:#6e5a43}.btn-show-notifications[_ngcontent-%COMP%]{background-color:#8a7155;color:#fff;border:none;padding:8px 15px;margin:10px auto;border-radius:4px;cursor:pointer;font-size:14px;display:block;max-width:800px}.btn-show-notifications[_ngcontent-%COMP%]:hover{background-color:#6e5a43}@media (max-width: 768px){.dashboard-container[_ngcontent-%COMP%]{padding:15px}.stats-container[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-template-rows:auto;max-width:100%}.welcome-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px}.stat-card[_ngcontent-%COMP%]{padding:15px;min-height:120px}.notifications-container[_ngcontent-%COMP%]{max-width:100%}}@media (max-width: 480px){.dashboard-container[_ngcontent-%COMP%]{padding:10px}.welcome-section[_ngcontent-%COMP%]{margin-bottom:20px}.stats-container[_ngcontent-%COMP%]{gap:15px;margin-bottom:20px}}"]})};export{k as BusinessmanHomeComponent};
