import{a as K}from"./chunk-VLWOHTJQ.js";import{a as S}from"./chunk-R7SPCFOW.js";import{a as J}from"./chunk-QJN4MAFU.js";import{f as q}from"./chunk-7B7PG3YE.js";import{R as H,g as V,j as k,p as D}from"./chunk-XXRYAUWQ.js";import{a as W}from"./chunk-FVAGXBDX.js";import"./chunk-XZSHE36Q.js";import{C as B,x as F,z as R}from"./chunk-S4BAPOHJ.js";import{a as j}from"./chunk-GUHNDTYU.js";import{d as E,e as L,k as U,s as P,u as G,w as z}from"./chunk-Z3ABZYYA.js";import"./chunk-GNQ3TXIC.js";import{$b as g,Fb as o,Gb as n,Hb as T,Lb as _,Pb as h,Qb as u,_a as e,ac as C,bc as b,db as v,e as I,ec as w,fc as M,gc as y,kb as x,la as f,lc as l,ma as m,mc as p,pb as O,wb as c,yb as A,zb as N}from"./chunk-LJ6G2VOH.js";function X(a,t){a&1&&(o(0,"div",4),g(1),l(2,"translate"),n()),a&2&&(e(),b(" ",p(2,1,"COMMON.LOADING")," "))}function Y(a,t){if(a&1){let i=_();o(0,"div",16)(1,"button",17),h("click",function(){let s=f(i).$implicit,d=u(2);return m(d.changeLanguage(s.value))}),g(2),n()()}if(a&2){let i=t.$implicit,r=u(2);e(),A("active",r.configuration.language===i.value),e(),b(" ",i.label," ")}}function Z(a,t){if(a&1){let i=_();o(0,"div")(1,"h2"),g(2),l(3,"translate"),n(),o(4,"div",5)(5,"label"),g(6),l(7,"translate"),n(),o(8,"div",6),O(9,Y,3,3,"div",7),n()(),o(10,"div",5)(11,"app-input",8),l(12,"translate"),y("ngModelChange",function(s){f(i);let d=u();return M(d.configuration.batchCodeFormat,s)||(d.configuration.batchCodeFormat=s),m(s)}),n()(),o(13,"div",5)(14,"label"),g(15),l(16,"translate"),n(),T(17,"app-theme-switcher",9),n(),o(18,"div",5)(19,"label"),g(20),l(21,"translate"),n(),o(22,"div",10)(23,"span",11),g(24),l(25,"translate"),n(),o(26,"button",12),g(27),l(28,"translate"),n()()(),o(29,"div",13)(30,"app-button",14),l(31,"translate"),h("click",function(){f(i);let s=u();return m(s.saveConfiguration())}),n(),o(32,"app-button",15),l(33,"translate"),h("click",function(){f(i);let s=u();return m(s.cancel())}),n()()()}if(a&2){let i=u();e(2),C(p(3,19,"CONFIGURATION.TITLE")),e(4),C(p(7,21,"CONFIGURATION.LANGUAGE")),e(3),c("ngForOf",i.languageOptions),e(2),c("label",p(12,23,"CONFIGURATION.BATCH_CODE"))("options",i.batchCodeOptions),w("ngModel",i.configuration.batchCodeFormat),c("fullWidth",!0),e(4),C(p(16,25,"CONFIGURATION.VIEW_MODE")),e(2),c("showLabels",!0)("fullWidth",!0),e(3),C(p(21,27,"CONFIGURATION.SUBSCRIPTION")),e(3),N("plan-"+i.configuration.subscriptionPlan),e(),b(" ",p(25,29,"PLANS."+((i.configuration.subscriptionPlan==null?null:i.configuration.subscriptionPlan.toUpperCase())||"BASIC"))," "),e(3),b(" ",p(28,31,"CONFIGURATION.MANAGE_PLAN")," "),e(3),c("label",p(31,33,"COMMON.SAVE"))("loading",i.isLoading),e(2),c("label",p(33,35,"COMMON.CANCEL"))("disabled",i.isLoading)}}function $(a,t){if(a&1){let i=_();o(0,"app-notification",18),h("close",function(){f(i);let s=u();return m(s.notification.show=!1)}),n()}if(a&2){let i=u();c("message",i.notification.message)("type",i.notification.type)}}var Q=class a{constructor(t,i,r,s){this.configurationService=t;this.authService=i;this.themeService=r;this.translateService=s;this.translateService.addLangs(["es","en"]),this.translateService.setDefaultLang("es"),this.translateService.use("es"),this.subscriptions.add(this.translateService.get(["CONFIGURATION.AUTOMATIC","CONFIGURATION.MANUAL"]).subscribe(d=>{console.log("Traducciones cargadas:",d)},d=>{console.error("Error al cargar traducciones:",d)}))}currentUserId="";configuration=null;languageOptions=[{label:"Espa\xF1ol",value:"es"},{label:"English",value:"en"}];batchCodeOptions=[{label:"Autom\xE1tico",value:"automatic"},{label:"Manual",value:"manual"}];isLoading=!1;notification={show:!1,message:"",type:"success"};subscriptions=new I;ngOnInit(){let t=this.authService.getCurrentUser();t&&t.id&&(this.currentUserId=t.id,this.loadConfiguration());let i=localStorage.getItem("userLanguage");i&&this.translateService.getLangs().includes(i)&&(this.translateService.use(i),this.updateTranslatedOptions())}ngOnDestroy(){this.subscriptions.unsubscribe()}changeLanguage(t){this.translateService.use(t),localStorage.setItem("userLanguage",t),this.configuration&&(this.configuration.language=t),this.updateTranslatedOptions()}updateTranslatedOptions(){let t=this.translateService.instant("CONFIGURATION.AUTOMATIC"),i=this.translateService.instant("CONFIGURATION.MANUAL");this.batchCodeOptions=[{label:t!=="CONFIGURATION.AUTOMATIC"?t:"Autom\xE1tico",value:"automatic"},{label:i!=="CONFIGURATION.MANUAL"?i:"Manual",value:"manual"}]}loadConfiguration(){this.isLoading=!0,this.configurationService.getByUserId(this.currentUserId).subscribe({next:t=>{Array.isArray(t)&&t.length>0?(this.configuration=t[0],this.applyConfigurationSettings()):Array.isArray(t)?(this.configuration=new S({userId:this.currentUserId,userType:"businessman",language:"es",batchCodeFormat:"automatic",viewMode:"auto",createdAt:new Date().toISOString(),subscriptionPlan:"basic",subscriptionStartDate:new Date().toISOString()}),this.saveConfiguration()):(this.configuration=t,this.applyConfigurationSettings()),this.isLoading=!1},error:t=>{console.error("Error al cargar configuraci\xF3n:",t),this.showNotification(this.translateService.instant("CONFIGURATION.ERROR_LOAD"),"error"),this.isLoading=!1,this.configuration=new S({userId:this.currentUserId,userType:"businessman",language:"es",batchCodeFormat:"automatic",viewMode:"auto",createdAt:new Date().toISOString(),subscriptionPlan:"basic",subscriptionStartDate:new Date().toISOString()})}})}applyConfigurationSettings(){this.configuration&&(this.configuration.language&&this.changeLanguage(this.configuration.language),this.configuration.viewMode&&this.themeService.syncFromConfiguration(this.configuration.viewMode))}saveConfiguration(){this.configuration&&(this.isLoading=!0,this.configuration.viewMode=this.themeService.getThemeForConfiguration(),this.configuration.updatedAt=new Date().toISOString(),this.configuration.id?this.configurationService.update(this.configuration.id,this.configuration).subscribe({next:()=>{this.showNotification(this.translateService.instant("CONFIGURATION.SUCCESS_SAVE"),"success"),this.isLoading=!1},error:t=>{console.error("Error al guardar configuraci\xF3n:",t),this.showNotification(this.translateService.instant("CONFIGURATION.ERROR_SAVE"),"error"),this.isLoading=!1}}):this.configurationService.create(this.configuration).subscribe({next:t=>{this.configuration=t,this.showNotification(this.translateService.instant("CONFIGURATION.SUCCESS_SAVE"),"success"),this.isLoading=!1},error:t=>{console.error("Error al crear configuraci\xF3n:",t),this.showNotification(this.translateService.instant("CONFIGURATION.ERROR_SAVE"),"error"),this.isLoading=!1}}))}cancel(){this.loadConfiguration()}showNotification(t,i){this.notification={show:!0,message:t,type:i}}static \u0275fac=function(i){return new(i||a)(v(W),v(z),v(j),v(F))};static \u0275cmp=x({type:a,selectors:[["app-businessman-configuration"]],decls:4,vars:3,consts:[[1,"configuration-container"],["class","loading-indicator",4,"ngIf"],[4,"ngIf"],[3,"message","type","close",4,"ngIf"],[1,"loading-indicator"],[1,"form-group"],[1,"language-options"],["class","language-option",4,"ngFor","ngForOf"],["type","select",3,"ngModelChange","label","options","ngModel","fullWidth"],["variant","buttons","size","medium",3,"showLabels","fullWidth"],[1,"subscription-info"],[1,"plan-badge"],["routerLink","/businessman/planes",1,"manage-plan-btn"],[1,"button-container"],["variant","primary",3,"click","label","loading"],["variant","secondary",3,"click","label","disabled"],[1,"language-option"],[1,"language-button",3,"click"],[3,"close","message","type"]],template:function(i,r){i&1&&(o(0,"div",0),O(1,X,3,3,"div",1)(2,Z,34,37,"div",2)(3,$,1,2,"app-notification",3),n()),i&2&&(e(),c("ngIf",r.isLoading),e(),c("ngIf",!r.isLoading&&r.configuration),e(),c("ngIf",r.notification.show))},dependencies:[U,E,L,D,V,k,q,H,J,K,B,R,G,P],styles:[".configuration-container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:500}.language-options[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:10px}.language-button[_ngcontent-%COMP%]{padding:8px 16px;background-color:#f5f5f5;border:1px solid #ddd;border-radius:4px;cursor:pointer;transition:all .3s}.language-button.active[_ngcontent-%COMP%]{background-color:#963;color:#fff;border-color:#963}.button-container[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:20px}.loading-indicator[_ngcontent-%COMP%]{text-align:center;padding:20px}.subscription-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.plan-badge[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;font-size:.85rem;font-weight:500}.plan-basic[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151}.plan-corporate[_ngcontent-%COMP%]{background:#963;color:#fff}.manage-plan-btn[_ngcontent-%COMP%]{padding:6px 12px;background:transparent;color:var(--primary-color);border:1px solid var(--primary-color);border-radius:6px;font-size:.85rem;cursor:pointer;transition:all .2s}.manage-plan-btn[_ngcontent-%COMP%]:hover{background:var(--primary-color);color:#fff}"]})};export{Q as BusinessmanConfigurationComponent};
