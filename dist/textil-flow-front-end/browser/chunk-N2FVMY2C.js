import{a as D}from"./chunk-ZCQD7NNS.js";import{a as U,b as R}from"./chunk-ICUDU4DM.js";import{a as F}from"./chunk-ZS6ABHG2.js";import{a as B}from"./chunk-JGNPUBHB.js";import{S as G,q as A}from"./chunk-3QVQVNEG.js";import"./chunk-ZM53J4V7.js";import{b as V}from"./chunk-GG34XMCG.js";import{d as w,e as P,l as y,t as E,v as k}from"./chunk-6CUNOLLP.js";import{C as T,x as N,z as L}from"./chunk-PY2MZTIA.js";import"./chunk-QHSPJAHQ.js";import"./chunk-2V72WRPO.js";import{$a as t,Ab as O,Bb as I,Hb as a,Ib as o,Jb as M,Nb as C,Rb as v,Sb as g,bc as p,cc as h,dc as b,e as S,eb as m,la as d,lb as x,ma as f,nc as s,oc as c,qb as _,yb as l}from"./chunk-3V6P7TZ6.js";function $(r,e){r&1&&(a(0,"div",4),p(1),s(2,"translate"),o()),r&2&&(t(),b(" ",c(2,1,"COMMON.LOADING")," "))}function j(r,e){if(r&1){let i=C();a(0,"div",15)(1,"button",16),v("click",function(){let u=d(i).$implicit,W=g(2);return f(W.changeLanguage(u.value))}),p(2),o()()}if(r&2){let i=e.$implicit,n=g(2);t(),O("active",n.configuration.language===i.value),t(),b(" ",i.label," ")}}function Q(r,e){if(r&1){let i=C();a(0,"div")(1,"h2"),p(2),s(3,"translate"),o(),a(4,"div",5)(5,"label"),p(6),s(7,"translate"),o(),a(8,"div",6),_(9,j,3,3,"div",7),o()(),a(10,"div",5)(11,"label"),p(12),s(13,"translate"),o(),M(14,"app-theme-switcher",8),o(),a(15,"div",5)(16,"label"),p(17),s(18,"translate"),o(),a(19,"div",9)(20,"span",10),p(21),s(22,"translate"),o(),a(23,"button",11),p(24),s(25,"translate"),o()()(),a(26,"div",12)(27,"app-button",13),s(28,"translate"),v("click",function(){d(i);let u=g();return f(u.saveConfiguration())}),o(),a(29,"app-button",14),s(30,"translate"),v("click",function(){d(i);let u=g();return f(u.cancel())}),o()()()}if(r&2){let i=g();t(2),h(c(3,15,"CONFIGURATION.TITLE")),t(4),h(c(7,17,"CONFIGURATION.LANGUAGE")),t(3),l("ngForOf",i.languageOptions),t(3),h(c(13,19,"CONFIGURATION.VIEW_MODE")),t(2),l("showLabels",!0)("fullWidth",!0),t(3),h(c(18,21,"CONFIGURATION.SUBSCRIPTION")),t(3),I("plan-"+i.configuration.subscriptionPlan),t(),b(" ",c(22,23,"PLANS."+((i.configuration.subscriptionPlan==null?null:i.configuration.subscriptionPlan.toUpperCase())||"BASIC"))," "),t(3),b(" ",c(25,25,"CONFIGURATION.MANAGE_PLAN")," "),t(3),l("label",c(28,27,"COMMON.SAVE"))("loading",i.isLoading),t(2),l("label",c(30,29,"COMMON.CANCEL"))("disabled",i.isLoading)}}function q(r,e){if(r&1){let i=C();a(0,"app-notification",17),v("close",function(){d(i);let u=g();return f(u.notification.show=!1)}),o()}if(r&2){let i=g();l("message",i.notification.message)("type",i.notification.type)}}var z=class r{constructor(e,i,n,u){this.configurationService=e;this.authService=i;this.themeService=n;this.translateService=u;this.translateService.addLangs(["es","en"]),this.translateService.setDefaultLang("es"),this.translateService.use("es")}currentUserId="";configuration=null;languageOptions=[{label:"Espa\xF1ol",value:"es"},{label:"English",value:"en"}];subscriptionOptions=[{label:"B\xE1sico",value:"basic"},{label:"Corporativo",value:"corporate"}];isLoading=!1;notification={show:!1,message:"",type:"success"};subscriptions=new S;ngOnInit(){let e=this.authService.getCurrentUser();e&&e.id&&(this.currentUserId=e.id,this.loadConfiguration()),this.subscriptions.add(this.themeService.theme$.subscribe(n=>{this.configuration&&this.configuration.viewMode!==n&&!this.isLoading&&(console.log(`\u{1F3A8} Tema cambiado externamente: ${this.configuration.viewMode} \u2192 ${n}`),this.configuration.viewMode=n,this.savePreferencesQuietly())}));let i=localStorage.getItem("userLanguage");i&&this.translateService.getLangs().includes(i)&&this.translateService.use(i)}ngOnDestroy(){this.subscriptions.unsubscribe()}changeLanguage(e){this.translateService.use(e),localStorage.setItem("userLanguage",e),this.configuration&&(this.configuration.language=e,this.savePreferencesOnly())}loadConfiguration(){this.isLoading=!0;let e=parseInt(this.currentUserId,10);this.configurationService.getConfigurationByUserId(e).subscribe({next:i=>{this.configuration=i,this.configuration.userType="supplier",this.applyConfigurationSettings(),this.isLoading=!1},error:i=>{console.error("Error al cargar configuraci\xF3n:",i),this.showNotification(this.translateService.instant("CONFIGURATION.ERROR_LOAD"),"error"),this.isLoading=!1,this.configuration=new U({userId:this.currentUserId,userType:"supplier",language:"es",viewMode:"auto",subscriptionPlan:"basic"})}})}applyConfigurationSettings(){this.configuration&&(this.configuration.language&&this.changeLanguageWithoutSave(this.configuration.language),this.configuration.viewMode&&this.themeService.syncFromConfiguration(this.configuration.viewMode))}changeLanguageWithoutSave(e){this.translateService.use(e),localStorage.setItem("userLanguage",e)}saveConfiguration(){if(this.configuration)if(this.isLoading=!0,this.configuration.viewMode&&this.themeService.setTheme(this.configuration.viewMode),this.configuration.id){let e=parseInt(this.configuration.id,10);console.log("\u{1F4BE} Guardando configuraci\xF3n:",{language:this.configuration.language,viewMode:this.configuration.viewMode,subscriptionPlan:this.configuration.subscriptionPlan}),this.configurationService.updateMultiplePreferences(e,{language:this.configuration.language,viewMode:this.configuration.viewMode,subscriptionPlan:this.configuration.subscriptionPlan}).subscribe({next:i=>{console.log("\u2705 Configuraci\xF3n guardada exitosamente:",i),this.configuration=i,this.configuration.userType="supplier",i.viewMode&&this.themeService.setTheme(i.viewMode),this.showNotification(this.translateService.instant("CONFIGURATION.SUCCESS_SAVE"),"success"),this.isLoading=!1},error:i=>{console.error("Error al guardar configuraci\xF3n:",i),this.showNotification(this.translateService.instant("CONFIGURATION.ERROR_SAVE"),"error"),this.isLoading=!1}})}else console.warn("\u26A0\uFE0F Configuraci\xF3n sin ID - el backend deber\xEDa crearla autom\xE1ticamente"),this.showNotification("Error: Configuraci\xF3n no encontrada","error"),this.isLoading=!1}savePreferencesQuietly(){if(!this.configuration||this.isLoading||!this.configuration.id)return;let e=parseInt(this.configuration.id,10);this.configurationService.updateUserPreferences(e,this.configuration.language,this.configuration.viewMode).subscribe({next:i=>{this.configuration.userType="supplier",this.configuration.subscriptionPlan=i.subscriptionPlan,this.configuration.updatedAt=i.updatedAt},error:i=>{console.error("Error al actualizar preferencias:",i)}})}savePreferencesOnly(){if(!this.configuration||this.isLoading)return;this.isLoading=!0;let e=parseInt(this.configuration.id,10);this.configurationService.updateUserPreferences(e,this.configuration.language,this.configuration.viewMode).subscribe({next:i=>{this.configuration=i,this.configuration.userType="supplier",this.showNotification(this.translateService.instant("CONFIGURATION.SUCCESS_SAVE"),"success"),this.isLoading=!1},error:i=>{console.error("Error al actualizar preferencias:",i),this.showNotification(this.translateService.instant("CONFIGURATION.ERROR_SAVE"),"error"),this.isLoading=!1}})}cancel(){this.loadConfiguration()}showNotification(e,i){this.notification={show:!0,message:e,type:i},setTimeout(()=>{this.notification.show=!1},3e3)}static \u0275fac=function(i){return new(i||r)(m(R),m(V),m(F),m(N))};static \u0275cmp=x({type:r,selectors:[["app-supplier-configuration"]],decls:4,vars:3,consts:[[1,"configuration-container"],["class","loading-indicator",4,"ngIf"],[4,"ngIf"],[3,"message","type","close",4,"ngIf"],[1,"loading-indicator"],[1,"form-group"],[1,"language-options"],["class","language-option",4,"ngFor","ngForOf"],["variant","buttons","size","medium",3,"showLabels","fullWidth"],[1,"subscription-info"],[1,"plan-badge"],["routerLink","/supplier/planes",1,"manage-plan-btn"],[1,"button-container"],["variant","primary",3,"click","label","loading"],["variant","secondary",3,"click","label","disabled"],[1,"language-option"],[1,"language-button",3,"click"],[3,"close","message","type"]],template:function(i,n){i&1&&(a(0,"div",0),_(1,$,3,3,"div",1)(2,Q,31,31,"div",2)(3,q,1,2,"app-notification",3),o()),i&2&&(t(),l("ngIf",n.isLoading),t(),l("ngIf",!n.isLoading&&n.configuration),t(),l("ngIf",n.notification.show))},dependencies:[y,w,P,A,G,B,D,T,L,k,E],styles:[".configuration-container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:500;color:#333}.language-options[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:10px}.language-button[_ngcontent-%COMP%]{padding:8px 16px;background-color:#f5f5f5;border:1px solid #ddd;border-radius:4px;cursor:pointer;transition:all .3s;color:#333}.language-button[_ngcontent-%COMP%]:hover{background-color:#e8e8e8}.language-button.active[_ngcontent-%COMP%]{background-color:#866c52;color:#fff;border-color:#866c52}.button-container[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:20px}.loading-indicator[_ngcontent-%COMP%]{text-align:center;padding:20px;color:#666}[data-theme=dark][_ngcontent-%COMP%]   .configuration-container[_ngcontent-%COMP%]{background-color:var(--background-color)}[data-theme=dark][_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--text-dark)}[data-theme=dark][_ngcontent-%COMP%]   .language-button[_ngcontent-%COMP%]{background-color:var(--surface-color);border:1px solid var(--border-color);color:var(--text-dark)}[data-theme=dark][_ngcontent-%COMP%]   .language-button[_ngcontent-%COMP%]:hover{background-color:var(--border-color)}[data-theme=dark][_ngcontent-%COMP%]   .language-button.active[_ngcontent-%COMP%]{background-color:var(--primary-color);color:var(--background-color);border-color:var(--primary-color)}[data-theme=dark][_ngcontent-%COMP%]   .loading-indicator[_ngcontent-%COMP%]{color:var(--text-light)}.subscription-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.plan-badge[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;font-size:.85rem;font-weight:500}.plan-basic[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151}.plan-corporate[_ngcontent-%COMP%]{background:#963;color:#fff}.manage-plan-btn[_ngcontent-%COMP%]{padding:6px 12px;background:transparent;color:var(--primary-color);border:1px solid var(--primary-color);border-radius:6px;font-size:.85rem;cursor:pointer;transition:all .2s}.manage-plan-btn[_ngcontent-%COMP%]:hover{background:var(--primary-color);color:#fff}"]})};export{z as SupplierConfigurationComponent};
