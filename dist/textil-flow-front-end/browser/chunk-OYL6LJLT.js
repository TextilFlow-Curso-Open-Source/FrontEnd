import{a as u}from"./chunk-QHSPJAHQ.js";import{g as d,h as v}from"./chunk-2V72WRPO.js";import{C as i,N as l,T as m,Z as E,ca as I,p as g,s as o}from"./chunk-3V6P7TZ6.js";var S={PENDIENTE:"PENDIENTE",ACEPTADO:"ACEPTADO",RECHAZADO:"RECHAZADO",COMPLETADO:"COMPLETADO",POR_ENVIAR:"POR_ENVIAR",ENVIADO:"ENVIADO"},p=class{id;code;client;businessmanId;supplierId;fabricType;color;quantity;price;observations;address;date;status;createdAt;updatedAt;imageUrl;constructor(e){this.id=e.id,this.code=e.code,this.client=e.client,this.businessmanId=e.businessmanId,this.supplierId=e.supplierId,this.fabricType=e.fabricType,this.color=e.color,this.quantity=e.quantity,this.price=e.price,this.observations=e.observations,this.address=e.address,this.date=e.date,this.status=e.status,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.imageUrl=e.imageUrl}};var y=class a{constructor(e){this.httpClient=e}serverBaseUrl=u.serverBaseUrl;resourceEndpoint=u.batchesEndpointPath;httpOptions={headers:new d({"Content-Type":"application/json"})};createBatch(e,t,s,r,n,B,b,O,f,A,T,U){let c={code:e,client:t,businessmanId:parseInt(s),supplierId:parseInt(r),fabricType:n,color:B,price:Number(b),quantity:Number(O),observations:f,address:A,date:T,status:"PENDIENTE",imageUrl:U||"https://via.placeholder.com/300x200?text=No+Image"};return console.log("\u{1F680} Enviando batch al backend:",c),this.httpClient.post(`${this.serverBaseUrl}${this.resourceEndpoint}`,c,this.httpOptions).pipe(o(h=>(console.log("\u2705 Respuesta del backend:",h),this.transformFromBackend(h))),l(2),i(this.handleError))}getAllBatches(){return this.httpClient.get(`${this.serverBaseUrl}${this.resourceEndpoint}`,this.httpOptions).pipe(o(e=>e.map(t=>this.transformFromBackend(t))),i(this.handleError))}getBatchById(e){return this.httpClient.get(`${this.serverBaseUrl}${this.resourceEndpoint}/${e}`,this.httpOptions).pipe(o(t=>this.transformFromBackend(t)),i(this.handleError))}getBySupplierId(e){return this.httpClient.get(`${this.serverBaseUrl}/batches/supplier/${e}`,this.httpOptions).pipe(o(t=>t.map(s=>this.transformFromBackend(s))),i(this.handleError))}getByBusinessmanId(e){return this.httpClient.get(`${this.serverBaseUrl}/batches/businessman/${e}`,this.httpOptions).pipe(o(t=>t.map(s=>this.transformFromBackend(s))),i(this.handleError))}updateBatch(e,t){console.log("\u{1F504} UpdateBatch - BatchId:",e),console.log("\u{1F504} UpdateBatch - Batch data:",t);let s=parseInt(e);return this.getBatchById(e).pipe(m(r=>{let n={batchId:s,code:t.code||r.code,client:t.client||r.client,businessmanId:Number(t.businessmanId||r.businessmanId),supplierId:Number(t.supplierId||r.supplierId),fabricType:t.fabricType||r.fabricType,color:t.color||r.color,quantity:Number(t.quantity||r.quantity),price:Number(t.price||r.price),observations:t.observations||r.observations||"",address:t.address||r.address||"",date:this.formatDateForBackend(t.date||r.date),status:t.status||r.status,imageUrl:r.imageUrl||""};return console.log("\u{1F680} Sending batch update (without new image):",JSON.stringify(n,null,2)),this.httpClient.put(`${this.serverBaseUrl}${this.resourceEndpoint}/${s}`,n,this.httpOptions)}),o(r=>(console.log("\u2705 Batch update response:",r),this.transformFromBackend(r))),i(this.handleError))}uploadBatchImage(e,t){console.log("\u{1F5BC}\uFE0F Uploading image for batch:",e);let s=new FormData;s.append("file",t);let r=new d({});return this.httpClient.post(`${this.serverBaseUrl}${this.resourceEndpoint}/${e}/image`,s,{headers:r,reportProgress:!0}).pipe(o(n=>(console.log("\u2705 Image upload response:",n),n)),i(this.handleError))}formatDateForBackend(e){if(!e)return new Date().toISOString().slice(0,10);if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;if(e.includes("T"))return e.split("T")[0];let t=new Date(e);return isNaN(t.getTime())?new Date().toISOString().slice(0,10):t.toISOString().slice(0,10)}deleteBatch(e){let t=parseInt(e);return this.httpClient.delete(`${this.serverBaseUrl}${this.resourceEndpoint}/${t}`,this.httpOptions).pipe(i(this.handleError))}deleteBatchImage(e){return this.httpClient.delete(`${this.serverBaseUrl}${this.resourceEndpoint}/${e}/image`,this.httpOptions).pipe(i(this.handleError))}getAll(){return this.getAllBatches()}findAll(){return this.getAllBatches()}getById(e){return this.getBatchById(e)}findById(e){return this.getBatchById(e)}create(e){return this.createBatch(e.code,e.client,e.businessmanId,e.supplierId,e.fabricType,e.color,e.price,e.quantity,e.observations||"",e.address||"",e.date,e.imageUrl)}delete(e){return this.deleteBatch(e)}update(e,t){let s=parseInt(e),r={code:t.code,client:t.client,businessmanId:parseInt(t.businessmanId),supplierId:parseInt(t.supplierId),fabricType:t.fabricType,color:t.color,quantity:t.quantity,price:t.price,observations:t.observations||"",address:t.address||"",date:t.date,status:t.status,imageUrl:t.imageUrl||"https://via.placeholder.com/300x200?text=No+Image"};return console.log("\u{1F504} Update full batch:",r),this.httpClient.put(`${this.serverBaseUrl}${this.resourceEndpoint}/${s}`,r,this.httpOptions).pipe(o(n=>(console.log("\u2705 Update full response:",n),this.transformFromBackend(n))),l(2),i(this.handleError))}transformFromBackend(e){return new p({id:e.id?.toString(),code:e.code||"",client:e.client||"",businessmanId:e.businessmanId?.toString()||"",supplierId:e.supplierId?.toString()||"",fabricType:e.fabricType||"",color:e.color||"",quantity:e.quantity||0,price:e.price||0,observations:e.observations||"",address:e.address||"",date:e.date||new Date().toISOString(),status:e.status||"PENDIENTE",createdAt:e.createdAt,updatedAt:e.updatedAt,imageUrl:e.imageUrl})}handleError=e=>{let t="Ocurri\xF3 un error desconocido";if(e.error instanceof ErrorEvent)t=`Error: ${e.error.message}`;else if(console.log("\u{1F50D} FULL ERROR OBJECT:",e),console.log("\u{1F50D} ERROR BODY:",e.error),console.log("\u{1F50D} ERROR STATUS:",e.status),console.log("\u{1F50D} ERROR HEADERS:",e.headers),e.error&&typeof e.error=="object")e.error.message?t=`Backend error: ${e.error.message}`:e.error.details?t=`Validation error: ${e.error.details}`:t=`Server error: ${JSON.stringify(e.error)}`;else switch(e.status){case 400:t=`Bad request (400): ${e.error||"Revisa los datos enviados"}`;break;case 401:t="No autorizado (401)";break;case 403:t="Acceso prohibido (403)";break;case 404:t="Recurso no encontrado (404)";break;case 500:t="Error interno del servidor (500)";break;default:t=`Error del servidor: ${e.status} - ${e.message}`}return console.error("\u274C Error en BatchService:",t),console.error("\u274C Error completo:",e),g(()=>new Error(t))};static \u0275fac=function(t){return new(t||a)(I(v))};static \u0275prov=E({token:a,factory:a.\u0275fac,providedIn:"root"})};export{S as a,p as b,y as c};
