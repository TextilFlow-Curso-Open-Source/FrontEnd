<div class="container">
  <!-- Pestañas superiores -->
  <div class="tab-navigation">
    <div
      class="tab-button"
      [class.active]="activeTab === 'pending'"
      (click)="setActiveTab('pending')">
      {{ 'BATCH_TABS.PENDING_BATCHES' | translate }}
    </div>
    <div
      class="tab-button"
      [class.active]="activeTab === 'register'"
      (click)="setActiveTab('register')">
      {{ 'BATCH_TABS.REGISTER_SHIPPING' | translate }}
    </div>
  </div>

  <!-- Contenido de Lotes Pendientes -->
  <div *ngIf="activeTab === 'pending'" class="tab-content">
    <h2>{{ 'BATCH_TABS.PENDING_BATCHES' | translate }}</h2>

    <div *ngIf="isLoading" class="loading">
      {{ 'COMMON.LOADING' | translate }}
    </div>

    <div *ngIf="!isLoading && pendingBatches.length === 0" class="empty-state">
      <p>{{ 'COMMON.NO_DATA' | translate }}</p>
    </div>

    <div *ngIf="!isLoading && pendingBatches.length > 0" class="batches-grid">
      <div *ngFor="let batch of pendingBatches" class="batch-card" (click)="selectBatch(batch)">
        <div class="batch-header">
          <h3>{{ 'BATCH.BATCH_CODE' | translate }}: {{ batch.code }}</h3>
          <span class="batch-status" [ngClass]="batch.status.toLowerCase().replace(' ', '-')">{{ batch.status }}</span>
        </div>
        <div class="batch-details">
          <p><strong>{{ 'BATCH.CLIENT' | translate }}:</strong> {{ batch.client }}</p>
          <p><strong>{{ 'BATCH.FABRIC_TYPE' | translate }}:</strong> {{ batch.fabricType }}</p>
          <p><strong>{{ 'BATCH.COLOR' | translate }}:</strong> {{ batch.color }}</p>
          <p><strong>{{ 'BATCH.QUANTITY' | translate }}:</strong> {{ batch.quantity }}</p>
          <p><strong>{{ 'BATCH.DATE' | translate }}:</strong> {{ batch.date | date:'dd/MM/yyyy' }}</p>
        </div>
        <app-button
          label="{{ 'COMMON.PROCESS' | translate }}"
          icon="send"
          variant="primary"
          (click)="selectBatch(batch)">
        </app-button>
      </div>
    </div>
  </div>

  <!-- Contenido de Registrar Envío -->
  <div *ngIf="activeTab === 'register'" class="tab-content">
    <h2>{{ 'BATCH_TABS.PROCESS_BATCH' | translate }}</h2>

    <div *ngIf="!selectedBatch" class="empty-state">
      <p>{{ 'BATCH_TABS.SELECT_PENDING' | translate }}</p>
      <app-button
        label="{{ 'BATCH_TABS.VIEW_PENDING' | translate }}"
        icon="list"
        variant="primary"
        (click)="setActiveTab('pending')">
      </app-button>
    </div>

    <form *ngIf="selectedBatch" [formGroup]="form" (ngSubmit)="onSubmit()" class="form-container">
      <div class="form-group">
        <app-input
          label="{{ 'BATCH.BATCH_CODE' | translate }}"
          type="text"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="code">
        </app-input>
      </div>

      <div class="form-group">
        <app-input
          label="{{ 'BATCH.CLIENT' | translate }}"
          type="text"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="client">
        </app-input>
      </div>

      <div class="form-group">
        <app-input
          label="{{ 'BATCH.FABRIC_TYPE' | translate }}"
          type="text"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="fabricType">
        </app-input>
      </div>

      <div class="form-group">
        <app-input
          label="{{ 'BATCH.COLOR' | translate }}"
          type="text"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="color">
        </app-input>
      </div>

      <div class="form-group">
        <app-input
          label="{{ 'BATCH.QUANTITY' | translate }}"
          type="number"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="quantity">
        </app-input>
      </div>

      <div class="form-group">
        <app-input
          label="{{ 'BATCH.PRICE' | translate }}"
          type="number"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="price">
        </app-input>
      </div>

      <div class="form-group full-width">
        <app-input
          label="{{ 'BATCH.ADDRESS' | translate }}"
          type="text"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="address">
        </app-input>
      </div>

      <div class="form-group">
        <app-input
          label="{{ 'BATCH.REGISTER_DATE' | translate }}"
          type="date"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="date">
        </app-input>
      </div>

      <div class="form-group full-width">
        <label>{{ 'BATCH.STATUS' | translate }}</label>
        <app-input
          type="select"
          [options]="availableStatuses"
          [fullWidth]="true"
          formControlName="status"
          placeholder="Selecciona un estado para el lote">
        </app-input>
        <small>{{ 'BATCH.SELECT_STATUS' | translate }}</small>
      </div>

      <div class="form-group full-width">
        <app-input
          label="{{ 'BATCH.CLIENT_OBSERVATIONS' | translate }}"
          type="textarea"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="observations">
        </app-input>
      </div>

      <div class="form-group full-width">
        <app-input
          label="{{ 'BATCH.ADDITIONAL_COMMENTS' | translate }}"
          type="textarea"
          [fullWidth]="true"
          formControlName="additionalComments"
          placeholder="Añade comentarios adicionales sobre el envío">
        </app-input>
      </div>

      <div class="form-group full-width">
        <label>{{ 'BATCH.SENDING_EVIDENCE' | translate }}</label>
        <app-input
          label="{{ 'BATCH.UPLOAD_IMAGE' | translate }}"
          type="file"
          [fullWidth]="true"
          formControlName="imageUrl"
          (change)="onFileChange($event)"
          accept="image/*">
        </app-input>

        <!-- Vista previa de la imagen -->
        <div *ngIf="imagePreview" class="image-preview">
          <h4>{{ 'BATCH.PREVIEW' | translate }}:</h4>
          <img [src]="imagePreview" alt="{{ 'BATCH.PREVIEW' | translate }}" class="preview-image">
        </div>

        <small>{{ 'BATCH.UPLOAD_EVIDENCE_HELP' | translate }}</small>
      </div>

      <div class="button-group">
        <app-button
          label="{{ 'COMMON.CANCEL' | translate }}"
          icon="close"
          variant="secondary"
          size="normal"
          (click)="onCancel()">
        </app-button>

        <app-button
          label="{{ 'COMMON.PROCESS' | translate }}"
          icon="send"
          variant="primary"
          size="normal"
          [loading]="isLoading"
          (click)="onSubmit()">
        </app-button>
      </div>
    </form>
  </div>

  <!-- Notificación -->
  <app-notification
    [show]="notification.show"
    [message]="notification.message"
    [type]="notification.type"
    [autoClose]="true"
    (close)="notification.show = false">
  </app-notification>
</div>
