<!-- supplier-register-batch.component.html -->
<div class="container">
  <!-- Pestañas superiores -->
  <div class="tab-navigation">
    <div
      class="tab-button"
      [class.active]="activeTab === 'pending'"
      (click)="setActiveTab('pending')">
      Lotes Pendientes
    </div>
    <div
      class="tab-button"
      [class.active]="activeTab === 'register'"
      (click)="setActiveTab('register')">
      Registrar Envío
    </div>
  </div>

  <!-- Contenido de Lotes Pendientes -->
  <div *ngIf="activeTab === 'pending'" class="tab-content">
    <h2>Lotes Pendientes de Envío</h2>

    <div *ngIf="isLoading" class="loading">
      Cargando lotes pendientes...
    </div>

    <div *ngIf="!isLoading && pendingBatches.length === 0" class="empty-state">
      <p>No tienes lotes pendientes de envío.</p>
    </div>

    <div *ngIf="!isLoading && pendingBatches.length > 0" class="batches-grid">
      <div *ngFor="let batch of pendingBatches" class="batch-card" (click)="selectBatch(batch)">
        <div class="batch-header">
          <h3>Código: {{ batch.code }}</h3>
          <span class="batch-status" [ngClass]="batch.status.toLowerCase().replace(' ', '-')">{{ batch.status }}</span>
        </div>
        <div class="batch-details">
          <p><strong>Cliente:</strong> {{ batch.client }}</p>
          <p><strong>Tipo de tela:</strong> {{ batch.fabricType }}</p>
          <p><strong>Color:</strong> {{ batch.color }}</p>
          <p><strong>Cantidad:</strong> {{ batch.quantity }}</p>
          <p><strong>Fecha solicitada:</strong> {{ batch.date | date:'dd/MM/yyyy' }}</p>
        </div>
        <app-button
          label="Procesar Lote"
          icon="send"
          variant="primary"
          (click)="selectBatch(batch)">
        </app-button>
      </div>
    </div>
  </div>

  <!-- Contenido de Registrar Envío -->
  <div *ngIf="activeTab === 'register'" class="tab-content">
    <h2>Procesar Lote</h2>

    <div *ngIf="!selectedBatch" class="empty-state">
      <p>Selecciona un lote pendiente para procesarlo.</p>
      <app-button
        label="Ver Lotes Pendientes"
        icon="list"
        variant="primary"
        (click)="setActiveTab('pending')">
      </app-button>
    </div>

    <form *ngIf="selectedBatch" [formGroup]="form" (ngSubmit)="onSubmit()" class="form-container">
      <div class="form-group">
        <app-input
          label="Código del Lote"
          type="text"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="code">
        </app-input>
      </div>

      <div class="form-group">
        <app-input
          label="Cliente"
          type="text"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="client">
        </app-input>
      </div>

      <div class="form-group">
        <app-input
          label="Tipo de tela"
          type="text"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="fabricType">
        </app-input>
      </div>

      <div class="form-group">
        <app-input
          label="Color"
          type="text"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="color">
        </app-input>
      </div>

      <div class="form-group">
        <app-input
          label="Cantidad"
          type="number"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="quantity">
        </app-input>
      </div>

      <div class="form-group">
        <app-input
          label="Precio"
          type="number"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="price">
        </app-input>
      </div>

      <div class="form-group full-width">
        <app-input
          label="Dirección de entrega"
          type="text"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="address">
        </app-input>
      </div>

      <div class="form-group">
        <app-input
          label="Fecha de solicitud"
          type="date"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="date">
        </app-input>
      </div>

      <div class="form-group full-width">
        <label>Estado del Lote</label>
        <app-input
          type="select"
          [options]="availableStatuses"
          [fullWidth]="true"
          formControlName="status"
          placeholder="Selecciona un estado para el lote">
        </app-input>
        <small>Selecciona el nuevo estado para este lote</small>
      </div>

      <div class="form-group full-width">
        <app-input
          label="Observaciones del cliente"
          type="textarea"
          [disabled]="true"
          [fullWidth]="true"
          formControlName="observations">
        </app-input>
      </div>

      <div class="form-group full-width">
        <app-input
          label="Observaciones adicionales"
          type="textarea"
          [fullWidth]="true"
          formControlName="additionalComments"
          placeholder="Añade comentarios adicionales sobre el envío">
        </app-input>
      </div>

      <div class="form-group full-width">
        <label>Evidencia del envío</label>
        <app-input
          label="Subir imagen"
          type="file"
          [fullWidth]="true"
          formControlName="imageUrl"
          (change)="onFileChange($event)"
          accept="image/*">
        </app-input>

        <!-- Vista previa de la imagen -->
        <div *ngIf="imagePreview" class="image-preview">
          <h4>Vista previa:</h4>
          <img [src]="imagePreview" alt="Vista previa" class="preview-image">
        </div>

        <small>Sube una imagen como evidencia del envío</small>
      </div>

      <div class="button-group">
        <app-button
          label="Cancelar"
          icon="close"
          variant="secondary"
          size="normal"
          (click)="onCancel()">
        </app-button>

        <app-button
          label="Procesar Lote"
          icon="send"
          variant="primary"
          size="normal"
          [loading]="isLoading"
          (click)="onSubmit()">
        </app-button>
      </div>
    </form>
  </div>

  <!-- Notificación -->
  <app-notification
    [show]="notification.show"
    [message]="notification.message"
    [type]="notification.type"
    [autoClose]="true"
    (close)="notification.show = false">
  </app-notification>
</div>
