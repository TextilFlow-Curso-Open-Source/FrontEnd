<div class="container">
  <!-- Pestañas superiores -->
  <div class="tab-navigation">
    <div
      class="tab-button"
      [class.active]="activeTab === 'current'"
      (click)="setActiveTab('current')">
      {{ 'SUPPLIER.CURRENT_BUSINESSES' | translate }}
    </div>
    <div
      class="tab-button"
      [class.active]="activeTab === 'new'"
      (click)="setActiveTab('new')">
      {{ 'SUPPLIER.NEW_BUSINESSES' | translate }}
    </div>
  </div>

  <div *ngIf="isLoading" class="loading-indicator">
    <p>{{ 'COMMON.LOADING' | translate }}</p>
  </div>

  <div *ngIf="requestsWithDetails.length === 0 && !isLoading" class="no-requests">
    <p>{{ 'SUPPLIER.NO_REQUESTS' | translate }}</p>
  </div>

  <div class="requests-list">
    <div *ngFor="let request of requestsWithDetails" class="business-item">
      <div class="business-header" (click)="toggleDetails(request.businessmanId)">
        <h3 class="business-name">{{ request.businessmanProfile?.companyName || ('COMMON.NO_NAME_COMPANY' | translate) }}</h3>
        <div class="dropdown-arrow" [class.expanded]="selectedBusinessId === request.businessmanId">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
      </div>

      <div class="business-basic-info">
        <div class="business-contact">
          <img [src]="request.businessmanProfile?.logo || 'assets/default-avatar.png'" alt="Logo" class="business-avatar">
          <span class="business-email">{{ request.businessmanId }}&#64;gmail.com</span>
        </div>

        <app-button
          *ngIf="activeTab === 'new'"
          label="{{ 'SUPPLIER.ACCEPT_REQUEST' | translate }}"
          variant="primary"
          [loading]="isLoading"
          (click)="updateRequestStatus(request.id, 'accepted')">
        </app-button>
      </div>

      <!-- Detalles expandibles del empresario -->
      <div *ngIf="selectedBusinessId === request.businessmanId" class="business-details">
        <div class="request-details">
          <p><strong>RUC:</strong> {{ request.businessmanProfile?.ruc || ('SUPPLIER.NO_SPECIFIED' | translate) }}</p>
          <p><strong>{{ 'SUPPLIER.BUSINESS_TYPE' | translate }}:</strong> {{ request.businessmanProfile?.businessType || ('SUPPLIER.NO_SPECIFIED' | translate) }}</p>
          <p><strong>{{ 'SUPPLIER.INDUSTRY' | translate }}:</strong> {{ request.businessmanProfile?.industry || ('SUPPLIER.NO_SPECIFIED' | translate) }}</p>
          <p><strong>{{ 'SUPPLIER.WEBSITE' | translate }}:</strong>
            <a *ngIf="request.businessmanProfile?.website"
               href="{{ request.businessmanProfile.website }}"
               target="_blank">
              {{ request.businessmanProfile.website }}
            </a>
            <span *ngIf="!request.businessmanProfile?.website">{{ 'SUPPLIER.NO_SPECIFIED' | translate }}</span>
          </p>
        </div>

        <div *ngIf="request.message" class="request-message">
          <h4>{{ 'REQUEST.MESSAGE' | translate }}:</h4>
          <p>{{ request.message }}</p>
        </div>

        <!-- Información específica de lotes solicitados -->
        <div *ngIf="request.batchType || request.color || request.quantity || request.address" class="batch-details">
          <h4>{{ 'SUPPLIER.REQUEST_DETAILS' | translate }}:</h4>
          <p *ngIf="request.batchType"><strong>{{ 'BATCH.FABRIC_TYPE' | translate }}:</strong> {{ request.batchType }}</p>
          <p *ngIf="request.color"><strong>{{ 'BATCH.COLOR' | translate }}:</strong> {{ request.color }}</p>
          <p *ngIf="request.quantity"><strong>{{ 'BATCH.QUANTITY' | translate }}:</strong> {{ request.quantity }}</p>
          <p *ngIf="request.address"><strong>{{ 'BATCH.ADDRESS' | translate }}:</strong> {{ request.address }}</p>
        </div>

        <!-- Acciones adicionales para solicitudes pendientes -->
        <div *ngIf="activeTab === 'new'" class="request-actions">
          <app-button
            label="{{ 'COMMON.REJECT' | translate }}"
            variant="secondary"
            [loading]="isLoading"
            (click)="updateRequestStatus(request.id, 'rejected')">
          </app-button>
        </div>
      </div>
    </div>
  </div>

  <app-notification
    [show]="notification.show"
    [message]="notification.message"
    [type]="notification.type"
    [autoClose]="true"
    (close)="closeNotification()">
  </app-notification>
</div>
